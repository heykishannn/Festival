<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festival Wishes</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Main Background Styles */
        .main-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 200vh; /* Double height for two pages */
            z-index: -1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: scroll;
        }
        
        /* Animation Styles (behind content) */
        .emoji-float {
            position: fixed;
            font-size: 1.5rem;
            pointer-events: none;
            z-index: -1;
            animation: float linear infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }
        
        /* Content Sections */
        .page-section {
            position: relative;
            min-height: 100vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
        }
        
        /* Media Box Styles */
        .media-box {
            width: 90%;
            max-width: 800px;
            margin: 0 auto 3rem;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            border: 4px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Text Content Styles */
        .title-text {
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            margin-bottom: 2.5rem;
        }
        
        .content-window {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            padding: 2rem;
            width: 90%;
            max-width: 800px;
            margin-bottom: 2rem;
        }
        
        /* Username Field */
        .username-field {
            border-radius: 24px;
            background: white;
            padding: 0.8rem 1.5rem;
            width: 90%;
            max-width: 400px;
            border: 2px solid rgba(209, 213, 219, 0.8);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        /* Button Styles */
        .action-btn {
            padding: 0.6rem 1.8rem;
            border-radius: 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-gradient {
            background: linear-gradient(90deg, var(--btn-color-1), var(--btn-color-2));
            color: white;
        }
        
        .translate-btn {
            padding: 0.6rem 1.5rem;
            font-size: 0.9rem;
            margin-top: 1.5rem;
        }
    </style>
</head>
<body class="font-sans overflow-x-hidden">
    <!-- Main Background (repeats automatically) -->
    <div id="mainBackground" class="main-bg"></div>
    
    <!-- First Page -->
    <section class="page-section">
        <!-- Media Box with Border -->
        <div id="mediaBox" class="media-box">
            <!-- Media will be inserted here -->
        </div>
        
        <!-- Title (transparent text) -->
        <h1 id="festivalTitle" class="text-4xl sm:text-5xl font-bold text-center text-white title-text"></h1>
        
        <!-- Content Window (blur effect) -->
        <div id="wishesContainer" class="content-window">
            <p id="hindiWish" class="text-xl sm:text-2xl mb-4 text-center"></p>
            <p id="englishWish" class="text-xl sm:text-2xl text-center"></p>
        </div>
        
        <!-- Username Field (solid white) -->
        <input type="text" id="userName" placeholder="Enter your name" class="username-field focus:ring-2 focus:ring-purple-500 focus:border-transparent font-medium text-gray-800">
        
        <!-- Action Buttons -->
        <div id="actionButtons" class="hidden flex flex-wrap justify-center gap-4 mt-6">
            <button id="shareBtn" class="action-btn btn-gradient hover:shadow-lg hover:scale-105">Share</button>
            <button id="copyBtn" class="action-btn btn-gradient hover:shadow-lg hover:scale-105">Copy</button>
        </div>
    </section>
    
    <!-- Second Page -->
    <section class="page-section">
        <!-- Translate Button -->
        <button id="translateBtn" class="translate-btn action-btn btn-gradient">Translate</button>
    </section>
    
    <!-- Audio Element -->
    <audio id="backgroundAudio" loop></audio>
    
    <script>
        const supabaseUrl = 'https://udupfqyxsxfmcekumrph.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVkdXBmcXl4c3hmbWNla3VtcnBoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1NTgxOTYsImV4cCI6MjA2NjEzNDE5Nn0.-ndlXo0XeRrzONovcOeiMZxeYY4st7XUXyVdWZVbZJs';
        const supaClient = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // DOM Elements
        const mainBackground = document.getElementById('mainBackground');
        const mediaBox = document.getElementById('mediaBox');
        const festivalTitle = document.getElementById('festivalTitle');
        const hindiWish = document.getElementById('hindiWish');
        const englishWish = document.getElementById('englishWish');
        const userName = document.getElementById('userName');
        const actionButtons = document.getElementById('actionButtons');
        const shareBtn = document.getElementById('shareBtn');
        const copyBtn = document.getElementById('copyBtn');
        const translateBtn = document.getElementById('translateBtn');
        const backgroundAudio = document.getElementById('backgroundAudio');
        
        // Current page URL
        const pageUrl = window.location.href;
        let isTranslated = false;
        let originalHindiWish = '';
        let originalEnglishWish = '';
        let shareDescription = '';
        
        // Load settings from Supabase
        async function loadSettings() {
            try {
                const { data, error } = await supaClient
                    .from('settings')
                    .select('value')
                    .eq('id', 'festival_settings')
                    .single();
                
                if (data) {
                    // Set background (repeats automatically)
                    if (data.value.background) {
                        if (data.value.background.startsWith('http') || data.value.background.startsWith('data:')) {
                            mainBackground.style.backgroundImage = `url('${data.value.background}')`;
                        } else {
                            mainBackground.style.backgroundColor = data.value.background;
                        }
                    }
                    
                    // Set title
                    document.title = data.value.title || 'Festival Wishes';
                    festivalTitle.textContent = data.value.title || '';
                    
                    // Set wishes
                    originalHindiWish = data.value.hindiWish || '';
                    originalEnglishWish = data.value.englishWish || '';
                    hindiWish.textContent = originalHindiWish;
                    englishWish.textContent = originalEnglishWish;
                    
                    // Set share description
                    shareDescription = data.value.shareDescription || '';
                    
                    // Set fonts and colors
                    if (data.value.hindiFont) {
                        const font = data.value.hindiFont === 'custom' ? data.value.customHindiFont : data.value.hindiFont;
                        hindiWish.style.fontFamily = font;
                    }
                    
                    if (data.value.englishFont) {
                        const font = data.value.englishFont === 'custom' ? data.value.customEnglishFont : data.value.englishFont;
                        englishWish.style.fontFamily = font;
                    }
                    
                    if (data.value.hindiColor) {
                        hindiWish.style.color = data.value.hindiColor;
                    }
                    
                    if (data.value.englishColor) {
                        englishWish.style.color = data.value.englishColor;
                    }
                    
                    // Set media
                    if (data.value.mediaUrl) {
                        mediaBox.innerHTML = '';
                        if (data.value.mediaUrl.includes('.mp4') || data.value.mediaUrl.includes('.webm')) {
                            const video = document.createElement('video');
                            video.src = data.value.mediaUrl;
                            video.autoplay = true;
                            video.loop = true;
                            video.muted = true;
                            video.controls = false;
                            video.style.width = '100%';
                            video.style.height = 'auto';
                            video.style.display = 'block';
                            mediaBox.appendChild(video);
                        } else {
                            const img = document.createElement('img');
                            img.src = data.value.mediaUrl;
                            img.style.width = '100%';
                            img.style.height = 'auto';
                            img.style.display = 'block';
                            mediaBox.appendChild(img);
                        }
                    }
                    
                    // Set audio
                    if (data.value.audioUrl && data.value.autoplay) {
                        backgroundAudio.src = data.value.audioUrl;
                        backgroundAudio.play().catch(e => console.log('Autoplay prevented:', e));
                    }
                    
                    // Create animations if enabled
                    if (data.value.animationEnable) {
                        createAnimations(
                            data.value.animationSpeed,
                            data.value.emojiType,
                            data.value.customEmojis,
                            data.value.animationQuantity === 'custom' ? 
                                data.value.customQuantity : 
                                data.value.animationQuantity
                        );
                    }
                    
                    // Set button styles
                    applyButtonStyles(
                        data.value.buttonStyle,
                        data.value.buttonColor
                    );
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        // Create animations
        function createAnimations(speed, emojiType, customEmojis, quantity) {
            const emojis = {
                flowers: ['ðŸŒ¸', 'ðŸŒº', 'ðŸŒ»', 'ðŸŒ¼', 'ðŸŒ·', 'ðŸ’', 'ðŸµï¸'],
                diyas: ['ðŸª”', 'ðŸª”', 'ðŸª”', 'ðŸª”', 'ðŸª”', 'ðŸª”', 'ðŸª”'],
                rangoli: ['âœ¨', 'ðŸŽ¨', 'ðŸŒˆ', 'ðŸŒŸ', 'ðŸŽ†', 'ðŸŽ‡', 'ðŸ§¿'],
                mixed: ['ðŸŒ¸', 'ðŸª”', 'âœ¨', 'ðŸŒº', 'ðŸª”', 'ðŸŽ¨', 'ðŸŒ»']
            };
            
            let selectedEmojis = emojis[emojiType] || emojis.flowers;
            if (emojiType === 'custom' && customEmojis) {
                selectedEmojis = customEmojis.split(',').map(e => e.trim()).filter(e => e);
            }
            
            const speedClass = `speed-${speed.toString().replace('.', '_')}`;
            let qty = 15;
            
            if (quantity === 'low') qty = 10;
            else if (quantity === 'medium') qty = 15;
            else if (quantity === 'high') qty = 25;
            else if (quantity === 'very-high') qty = 40;
            else if (!isNaN(quantity)) qty = Math.min(100, Math.max(1, parseInt(quantity)));
            
            for (let i = 0; i < qty; i++) {
                setTimeout(() => createEmoji(speedClass, selectedEmojis), i * 300);
            }
            
            setInterval(() => {
                createEmoji(speedClass, selectedEmojis);
            }, 3000);
        }
        
        function createEmoji(speedClass, emojis) {
            const emoji = document.createElement('div');
            emoji.className = `emoji-float ${speedClass}`;
            emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            emoji.style.left = `${Math.random() * 100}vw`;
            emoji.style.top = `${100 + Math.random() * 20}vh`;
            emoji.style.opacity = Math.random() * 0.5 + 0.3;
            emoji.style.fontSize = `${Math.random() * 1 + 1}rem`;
            document.body.appendChild(emoji);
            
            setTimeout(() => {
                emoji.remove();
            }, 8000);
        }
        
        // Apply button styles
        function applyButtonStyles(style, color) {
            const buttons = [shareBtn, copyBtn, translateBtn];
            
            if (style === 'gradient') {
                const color1 = color;
                const color2 = adjustColor(color, 20);
                
                buttons.forEach(btn => {
                    btn.style.setProperty('--btn-color-1', color1);
                    btn.style.setProperty('--btn-color-2', color2);
                });
            }
        }
        
        // Helper function to adjust color
        function adjustColor(color, amount) {
            return '#' + color.replace(/^#/, '').replace(/../g, color => 
                ('0' + Math.min(255, Math.max(0, parseInt(color, 16) + amount)).toString(16)).slice(-2));
        }
        
        // Show name input and buttons when name is entered
        userName.addEventListener('input', () => {
            if (userName.value.trim()) {
                actionButtons.classList.remove('hidden');
            } else {
                actionButtons.classList.add('hidden');
            }
        });
        
        // Translate button click
        translateBtn.addEventListener('click', () => {
            if (isTranslated) {
                hindiWish.textContent = originalHindiWish;
                englishWish.textContent = originalEnglishWish;
                translateBtn.textContent = 'Translate';
            } else {
                if (originalHindiWish && !originalEnglishWish) {
                    englishWish.textContent = "[Translated] " + originalHindiWish;
                } else if (!originalHindiWish && originalEnglishWish) {
                    hindiWish.textContent = "[Translated] " + originalEnglishWish;
                }
                translateBtn.textContent = 'Show Original';
            }
            isTranslated = !isTranslated;
        });
        
        // Share button click
        shareBtn.addEventListener('click', () => {
            const shareMessage = `${userName.value.trim()} ${shareDescription}\n\n${pageUrl}`;
            
            if (navigator.share) {
                navigator.share({
                    title: document.title,
                    text: shareMessage,
                    url: pageUrl
                }).catch(err => {
                    console.log('Error sharing:', err);
                    fallbackShare(shareMessage);
                });
            } else {
                fallbackShare(shareMessage);
            }
        });
        
        // Fallback share method
        function fallbackShare(message) {
            const textArea = document.createElement('textarea');
            textArea.value = message;
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('Share text copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy:', err);
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            }
            
            document.body.removeChild(textArea);
        }
        
        // Copy button click
        copyBtn.addEventListener('click', () => {
            const shareMessage = `${userName.value.trim()} ${shareDescription}\n\n${pageUrl}`;
            
            navigator.clipboard.writeText(shareMessage).then(() => {
                alert('Wish copied to clipboard!');
            }).catch(err => {
                console.error('Could not copy text: ', err);
            });
        });
        
        // Play audio when page is visible
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible' && backgroundAudio.src) {
                backgroundAudio.play().catch(e => console.log('Play prevented:', e));
            } else {
                backgroundAudio.pause();
            }
        });
        
        // Load settings when page loads
        document.addEventListener('DOMContentLoaded', loadSettings);
    </script>
</body>
</html>