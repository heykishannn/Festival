<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festival Wishes</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Reset and Base Styles */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }
        
        /* Animation Container */
        .animation-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        /* Background Styles */
        .background-container {
            position: relative;
            width: 100%;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .main-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: -1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .second-bg {
            position: absolute;
            top: 100vh;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: -1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: none;
        }
        
        /* Content Container */
        .content-container {
            position: relative;
            width: 100%;
            min-height: 100vh;
            display: flex;
	    z-index: 2;
            flex-direction: column;
        }
        
        /* Page Sections */
        .page-section {
            position: relative;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
            box-sizing: border-box;
        }
        
        /* Title Glass Effect */
        .title-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            width: 90%;
	    z-index: 2;
            max-width: 800px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        /* Frame Image */
        .frame-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
            z-index: 2;
        }
        
        /* Media Box */
        .media-box {
            width: 90%;
            max-width: 800px;
            margin: 0 auto 3rem;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }
        
        /* Content Window - Glass Effect */
        .content-window {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            width: 90%;
	    z-index: 2;
            max-width: 800px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        /* Text Styles */
        .wish-text {
            font-weight: bold;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            white-space: pre-line;
        }
        
        /* Username Field */
        .username-field {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid white;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 40px;
            padding: 12px 20px;
            color: white;
            font-size: 16px;
            outline: none;
            width: 90%;
	    z-indez: 2;
            max-width: 400px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            margin-bottom: 1rem;
        }
        
        /* Buttons */
        .action-btn {
            padding: 0.8rem 2rem;
            border-radius: 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            z-index: 1;
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }
        
        /* Translate Text */
        .translate-text {
            color: #1F51FF;
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 1rem;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
            z-index: 1;
        }
        
        /* Ads */
        .bottom-ad-container {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 1rem;
            box-sizing: border-box;
            z-index: 100;
        }
        
        .bottom-ad {
            width: 100%;
            max-width: 800px;
            height: auto;
            min-height: 90px;
            z-index: 100;
            background-color: transparent;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .footer-ad {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .footer-ad-content {
            width: 468px;
            height: 60px;
            background-color: #e0e0e0;
        }

        /* Animation Styles */
        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }

        @keyframes fall {
            0% { transform: translateY(-100px); }
            100% { transform: translateY(100vh); }
        }

        @keyframes swirl {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(50px, 50px) rotate(180deg); }
            100% { transform: translate(0, 0) rotate(360deg); }
        }

        @keyframes fireworks {
            0% { transform: translate(0, 0) scale(0.5); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(1.5); opacity: 0; }
        }

        .floating-emoji {
            position: absolute;
            animation: float 3s ease-in-out infinite;
            font-size: 24px;
        }
        .falling-emoji {
            position: absolute;
            animation: fall linear forwards;
        }
        .swirling-emoji {
            position: absolute;
            animation: swirl 5s linear infinite;
        }
        .fireworks-emoji {
            position: absolute;
            animation: fireworks 1s ease-out forwards;
        }
    </style>
</head>
<body class="font-sans">
    <!-- Animation Container -->
    <div id="animationContainer" class="animation-container"></div>
    
    <!-- Background Container -->
    <div class="background-container">
        <!-- Backgrounds -->
        <div id="mainBackground" class="main-bg"></div>
        <div id="secondBackground" class="second-bg"></div>
        
        <!-- Content Container -->
        <div class="content-container">
            <!-- First Page -->
            <section class="page-section">
                <!-- Media Box -->
                <div id="mediaBox" class="media-box">
                    <!-- Media will be inserted here -->
                </div>
                
                <!-- Title with Glass Effect -->
                <div id="titleContainer" class="title-container">
                    <div id="frameOverlayTitle" class="frame-overlay"></div>
                    <h1 id="festivalTitle" class="text-3xl md:text-4xl font-bold text-center text-white drop-shadow-lg"></h1>
                </div>
                
                <!-- Content Window with Glass Effect -->
                <div id="wishesContainer" class="content-window">
                    <div id="frameOverlayContent" class="frame-overlay"></div>
                    <p id="hindiWish" class="wish-text text-xl sm:text-2xl mb-6 text-center text-white"></p>
                    <p id="englishWish" class="wish-text text-xl sm:text-2xl text-center text-white hidden"></p>
                    <div id="translateBtn" class="translate-text text-center">Translate</div>
                </div>
                
                <!-- Username Field -->
                <input type="text" id="userName" placeholder="Enter your name" class="username-field focus:ring-transparent focus:border-white-1000 font-medium">
                
                <!-- Action Buttons -->
                <div id="actionButtons" class="hidden flex flex-col items-center gap-4 mt-6" style="z-index: 1;">
                    <button id="shareBtn" class="action-btn btn-gradient hover:shadow-lg hover:scale-105 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5z"/>
                        </svg>
                        Share
                    </button>
                    <button id="copyBtn" class="action-btn btn-gradient hover:shadow-lg hover:scale-105 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                            <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                        </svg>
                        Copy
                    </button>
                </div>
                
                <!-- Bottom Ad Placeholder -->
                <div class="bottom-ad-container">
                    <div id="bottomAd" class="bottom-ad">
                        <!-- Ad will be inserted here -->
<script type="text/javascript">
	atOptions = {
		'key' : '8a596a14d2ea184cd9b6372e267b931c',
		'format' : 'iframe',
		'height' : 50,
		'width' : 320,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/8a596a14d2ea184cd9b6372e267b931c/invoke.js"></script>
                    </div>
                </div>
            </section>
            
            <!-- Second Page (if content exists) -->
            <section id="secondPage" class="page-section" style="display: none;">
                <!-- Additional content can be added here -->
            </section>
        </div>
    </div>
    
    <!-- Fixed Footer Ad -->
    <div class="footer-ad">
        <div id="footerAd" class="footer-ad-content"><script type="text/javascript">
	atOptions = {
		'key' : 'f3980c7d80f3803dbaf4228f02da605b',
		'format' : 'iframe',
		'height' : 60,
		'width' : 468,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/f3980c7d80f3803dbaf4228f02da605b/invoke.js"></script></div>
    </div>
    
    <!-- Audio Element -->
    <audio id="backgroundAudio" loop></audio>
    
    <script>
        const supabaseUrl = 'https://udupfqyxsxfmcekumrph.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVkdXBmcXl4c3hmbWNla3VtcnBoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1NTgxOTYsImV4cCI6MjA2NjEzNDE5Nn0.-ndlXo0XeRrzONovcOeiMZxeYY4st7XUXyVdWZVbZJs';
        const supaClient = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // DOM Elements
        const mainBackground = document.getElementById('mainBackground');
        const secondBackground = document.getElementById('secondBackground');
        const mediaBox = document.getElementById('mediaBox');
        const titleContainer = document.getElementById('titleContainer');
        const festivalTitle = document.getElementById('festivalTitle');
        const frameOverlayTitle = document.getElementById('frameOverlayTitle');
        const frameOverlayContent = document.getElementById('frameOverlayContent');
        const hindiWish = document.getElementById('hindiWish');
        const englishWish = document.getElementById('englishWish');
        const userName = document.getElementById('userName');
        const actionButtons = document.getElementById('actionButtons');
        const shareBtn = document.getElementById('shareBtn');
        const copyBtn = document.getElementById('copyBtn');
        const translateBtn = document.getElementById('translateBtn');
        const backgroundAudio = document.getElementById('backgroundAudio');
        const bottomAd = document.getElementById('bottomAd');
        const footerAd = document.getElementById('footerAd');
        const secondPage = document.getElementById('secondPage');
        const animationContainer = document.getElementById('animationContainer');
        
        // Fixed URL for sharing
        const fixedShareUrl = 'https://heykishannn.github.io/Festival/';
        let isTranslated = false;
        let originalHindiWish = '';
        let originalEnglishWish = '';
        let shareDescription = '';
        let hasSecondPageContent = false;
        let audioPlayAttempted = false;
	    
        // Auto-play audio when page becomes visible
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                playBackgroundAudio();
            } else {
                backgroundAudio.pause();
            }
        });

        // Play audio function
        function playBackgroundAudio() {
            if (backgroundAudio.src && !audioPlayAttempted) {
                const playPromise = backgroundAudio.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        audioPlayAttempted = true;
                    })
                    .catch(error => {
                        console.log('Autoplay prevented:', error);
                        // Try again when user interacts
                        const onceOptions = { once: true };
                        document.body.addEventListener('click', () => {
                            backgroundAudio.play().catch(e => console.log('Still prevented:', e));
                        }, onceOptions);
                    });
                }
            }
	    }
	    
        // Load settings from Supabase
        async function loadSettings() {
            try {
                const { data, error } = await supaClient
                    .from('settings')
                    .select('value')
                    .eq('id', 'festival_settings')
                    .single();
                
                if (data) {
                    // Set backgrounds
                    if (data.value.background) {
                        if (data.value.background.startsWith('http') || data.value.background.startsWith('data:')) {
                            mainBackground.style.backgroundImage = `url('${data.value.background}')`;
                        } else {
                            mainBackground.style.background = data.value.background;
                        }
                    }
                    
                    if (data.value.secondBackground) {
                        if (data.value.secondBackground.startsWith('http') || data.value.secondBackground.startsWith('data:')) {
                            secondBackground.style.backgroundImage = `url('${data.value.secondBackground}')`;
                            secondBackground.style.display = 'block';
                        } else {
                            secondBackground.style.background = data.value.secondBackground;
                            secondBackground.style.display = 'block';
                        }    
                    }
                    
                    // Set title with custom styles
                    document.title = data.value.title || 'Festival Wishes';
                    festivalTitle.textContent = data.value.title || '';
                    
                    // Apply title styles from admin panel
                    if (data.value.titleFont) {
                        festivalTitle.style.fontFamily = data.value.titleFont;
                    }
                    if (data.value.titleColor) {
                        festivalTitle.style.color = data.value.titleColor;
                    }
                    if (data.value.titleSize) {
                        festivalTitle.classList.add(data.value.titleSize);
                    }
                    
                    // Set wishes with formatting
                    originalHindiWish = data.value.hindiWish || '';
                    originalEnglishWish = data.value.englishWish || '';
                    hindiWish.innerHTML = processWishText(originalHindiWish);
                    
                    // Only show English wish if it exists
                    if (originalEnglishWish) {
                        englishWish.innerHTML = processWishText(originalEnglishWish);
                        translateBtn.classList.remove('hidden');
                    } else {
                        englishWish.innerHTML = '';
                        translateBtn.classList.add('hidden');
                    }
                    
                    // Apply Hindi text styles from admin panel
                    if (data.value.hindiFont) {
                        hindiWish.style.fontFamily = data.value.hindiFont;
                    }
                    if (data.value.hindiColor) {
                        hindiWish.style.color = data.value.hindiColor;
                    }
                    
                    // Apply English text styles from admin panel
                    if (data.value.englishFont) {
                        englishWish.style.fontFamily = data.value.englishFont;
                    }
                    if (data.value.englishColor) {
                        englishWish.style.color = data.value.englishColor;
                    }
                    
                    // Set share description
                    shareDescription = data.value.shareDescription || '';
                    
                    // Set media
                    if (data.value.mediaUrl) {
                        mediaBox.innerHTML = '';
                        if (data.value.mediaUrl.includes('.mp4') || data.value.mediaUrl.includes('.webm')) {
                            const video = document.createElement('video');
                            video.src = data.value.mediaUrl;
                            video.autoplay = true;
                            video.loop = true;
                            video.muted = true;
                            video.controls = false;
                            video.style.width = '100%';
                            video.style.height = 'auto';
                            video.style.display = 'block';
                            mediaBox.appendChild(video);
                        } else {
                            const img = document.createElement('img');
                            img.src = data.value.mediaUrl;
                            img.style.width = '100%';
                            img.style.height = 'auto';
                            img.style.display = 'block';
                            mediaBox.appendChild(img);
                        }
                    }
                    
                    // Set frame images
                    if (data.value.frameUrl) {
                        frameOverlayTitle.style.backgroundImage = `url('${data.value.frameUrl}')`;
                        frameOverlayTitle.style.opacity = (data.value.frameOpacity || 100) / 100;
                        frameOverlayTitle.style.objectFit = data.value.framePosition || 'cover';
                        
                        // Use same frame for content or different if specified
                        frameOverlayContent.style.backgroundImage = `url('${data.value.frameUrl}')`;
                        frameOverlayContent.style.opacity = (data.value.frameOpacity || 100) / 100;
                        frameOverlayContent.style.objectFit = data.value.framePosition || 'cover';
                    }
                    
                    // Set wish box background
                    if (data.value.wishBgUrl) {
                        contentWindow.style.backgroundImage = `url('${data.value.wishBgUrl}')`;
                        contentWindow.style.backgroundSize = data.value.wishBgSize || 'cover';
                        contentWindow.style.backgroundRepeat = data.value.wishBgRepeat || 'no-repeat';
                    }
                    
                    // Set audio
                    if (data.value.audioUrl) {
                        backgroundAudio.src = data.value.audioUrl;
                        // Try to play audio immediately
                        playBackgroundAudio();
                    }
                    
                    // Set button styles
                    applyButtonStyles(
                        data.value.buttonStyle,
                        data.value.buttonColor
                    );
                    
                    // Check if second page should be visible
                    if (data.value.secondPageContent) {
                        secondPage.style.display = 'flex';
                        hasSecondPageContent = true;
                    }
                    
                    // Initialize animations if enabled
                    if (data.value.animationEnable) {
                        initAnimations(data.value);
                    }
                    
                    // Adjust scroll height based on content
                    adjustScrollHeight();
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        // Initialize animations
        function initAnimations(settings) {
            // Clear existing animations
            animationContainer.innerHTML = '';
            
            // Create emojis based on settings
            const emojiSet = getEmojiSet(settings.emojiType, settings.customEmojis);
            const quantity = getAnimationQuantity(settings.animationQuantity, settings.customQuantity);
            const speed = getAnimationSpeed(settings.animationSpeed, settings.customSpeed);
            
            for (let i = 0; i < quantity; i++) {
                createEmoji(emojiSet, speed, settings.animationType);
            }
        }
        
        function createEmoji(emojiSet, speed, animationType) {
            const emoji = document.createElement('div');
            emoji.textContent = emojiSet[Math.floor(Math.random() * emojiSet.length)];
            emoji.style.fontSize = `${Math.random() * 20 + 16}px`;
		
            // Set animation based on type
            switch(animationType) {
                case 'fall':
                    emoji.className = 'falling-emoji';
                    emoji.style.animationDuration = `${5 / speed}s`;
                    emoji.style.left = `${Math.random() * 100}%`;
                    emoji.style.top = '-50px';
                    break;
                case 'swirl':
                    emoji.className = 'swirling-emoji';
                    emoji.style.animationDuration = `${8 / speed}s`;
                    emoji.style.left = `${Math.random() * 100}%`;
                    emoji.style.top = `${Math.random() * 100}%`;
                    break;
                case 'fireworks':
                    emoji.className = 'fireworks-emoji';
                    emoji.style.setProperty('--tx', `${Math.random() * 100 - 50}px`);
                    emoji.style.setProperty('--ty', `${Math.random() * 100 - 50}px`);
                    emoji.style.left = '50%';
                    emoji.style.top = '50%';
                    emoji.style.animationDuration = `${1 / speed}s`;
                    break;
                case 'confetti':
                    // Similar to fireworks but with different animation
                    emoji.className = 'fireworks-emoji';
                    emoji.style.setProperty('--tx', `${Math.random() * 200 - 100}px`);
                    emoji.style.setProperty('--ty', `${Math.random() * 200 - 100}px`);
                    emoji.style.left = '50%';
                    emoji.style.top = '50%';
                    emoji.style.animationDuration = `${1.5 / speed}s`;
                    break;
                default: // float
                    emoji.className = 'floating-emoji';
                    emoji.style.animationDuration = `${3 / speed}s`;
                    emoji.style.left = `${Math.random() * 100}%`;
                    emoji.style.top = `${Math.random() * 100}%`;
	    }
		
            animationContainer.appendChild(emoji);
            
            // For falling emojis, remove after animation completes
            if (animationType === 'fall') {
                emoji.addEventListener('animationend', () => {
                    emoji.remove();
                    // Create new falling emoji to maintain quantity
                    createEmoji(emojiSet, speed, animationType);
                });
            }
            
            // For fireworks/confetti, remove after animation completes
            if (animationType === 'fireworks' || animationType === 'confetti') {
                emoji.addEventListener('animationend', () => {
                    emoji.remove();
                    // Create new firework to maintain quantity
                    createEmoji(emojiSet, speed, animationType);
                });
	    }
	}
        
        function getEmojiSet(type, customEmojis) {
            const sets = {
                flowers: ['ðŸŒ¸', 'ðŸŒº', 'ðŸŒ»', 'ðŸŒ¼', 'ðŸŒ·', 'ðŸ’'],
                diyas: ['ðŸª”', 'âœ¨', 'ðŸ•¯ï¸', 'ðŸŒŸ'],
                rangoli: ['ðŸŸ¡', 'ðŸ”´', 'ðŸŸ¢', 'ðŸ”µ', 'ðŸŸ£'],
                festive: ['ðŸŽ‰', 'ðŸŽŠ', 'ðŸª…', 'ðŸŽ', 'ðŸ§§'],
                hearts: ['â¤ï¸', 'ðŸ§¡', 'ðŸ’›', 'ðŸ’š', 'ðŸ’™', 'ðŸ’œ'],
                stars: ['â­', 'ðŸŒŸ', 'âœ¨', 'ðŸ’«'],
                mixed: ['ðŸŒ¸', 'ðŸª”', 'ðŸŽ‰', 'â¤ï¸', 'â­', 'âœ¨']
            };
            
            if (type === 'custom' && customEmojis) {
                return customEmojis.split(',').map(e => e.trim());
            }
            return sets[type] || sets.mixed;
        }
        
        function getAnimationQuantity(type, customQuantity) {
            const quantities = {
                low: 5,
                medium: 10,
                high: 20,
                'very-high': 30
            };
            
            if (type === 'custom' && customQuantity) {
                return Math.min(100, Math.max(1, parseInt(customQuantity)));
            }
            return quantities[type] || 10;
        }
        
        function getAnimationSpeed(type, customSpeed) {
            if (type === 'custom' && customSpeed) {
                return parseFloat(customSpeed);
            }
            return parseFloat(type) || 1;
        }
        
        // Apply button styles
        function applyButtonStyles(style, color) {
            const buttons = [shareBtn, copyBtn];
            
            if (style === 'gradient') {
                const color1 = color;
                const color2 = adjustColor(color, 20);
                
                buttons.forEach(btn => {
                    btn.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
                });
            } else if (style === 'solid') {
                buttons.forEach(btn => {
                    btn.style.background = color;
                });
            } else if (style === 'outline') {
                buttons.forEach(btn => {
                    btn.style.background = 'transparent';
                    btn.style.border = `2px solid ${color}`;
                    btn.style.color = color;
                });
            }
        }
        
        // Helper function to adjust color
        function adjustColor(color, amount) {
            return '#' + color.replace(/^#/, '').replace(/../g, color => 
                ('0' + Math.min(255, Math.max(0, parseInt(color, 16) + amount)).toString(16)).slice(-2));
        }
        
        // Adjust scroll height based on content
        function adjustScrollHeight() {
            if (!hasSecondPageContent) {
                document.body.style.overflowY = 'auto';
                const contentHeight = document.querySelector('.content-container').scrollHeight;
                document.documentElement.style.height = contentHeight + 'px';
            }
        }
        
        // Show name input and buttons when name is entered
        userName.addEventListener('input', () => {
            if (userName.value.trim()) {
                actionButtons.classList.remove('hidden');
            } else {
                actionButtons.classList.add('hidden');
            }
        });
        
        // Translate button click
        translateBtn.addEventListener('click', () => {
            if (!originalEnglishWish) {
                // If no English wish set, don't show anything when translating
                englishWish.textContent = "";
                return;
            }
            
            if (isTranslated) {
                hindiWish.classList.remove('hidden');
                englishWish.classList.add('hidden');
                translateBtn.textContent = 'Translate to English';
            } else {
                hindiWish.classList.add('hidden');
                englishWish.classList.remove('hidden');
                translateBtn.textContent = 'Show in Hindi';
            }
            isTranslated = !isTranslated;
        });
        
        // Share button click - Universal Share Function
        shareBtn.addEventListener('click', async () => {
            const name = userName.value.trim() || "Someone";
            let shareMessage = `${name} ${shareDescription}\n${fixedShareUrl}`;

            try {
                if (navigator.share) {
                    // Web Share API (mobile devices)
                    await navigator.share({
                        title: document.title,
                        text: shareMessage,
                        url: fixedShareUrl
                    });
                } else if (navigator.clipboard) {
                    // Clipboard API (desktop browsers)
                    await navigator.clipboard.writeText(shareMessage);
                    alert('Share text copied to clipboard!');
                    
                    // Fallback to WhatsApp if possible
                    if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                        window.open(`https://wa.me/?text=${encodeURIComponent(shareMessage)}`, '_blank');
                    }
                } else {
                    // Final fallback - open WhatsApp or SMS
                    if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                        window.open(`https://wa.me/?text=${encodeURIComponent(shareMessage)}`, '_blank');
                    } else {
                        // For desktop browsers that don't support clipboard
                        const textArea = document.createElement('textarea');
                        textArea.value = shareMessage;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        alert('Share text copied to clipboard!');
                    }
                }
            } catch (err) {
                console.error('Error sharing:', err);
                
                // Ultimate fallback - try different methods based on platform
                try {
                    if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                        // Mobile devices - try WhatsApp
                        window.open(`https://wa.me/?text=${encodeURIComponent(shareMessage)}`, '_blank');
                    } else {
                        // Desktop - copy to clipboard
                        const textArea = document.createElement('textarea');
                        textArea.value = shareMessage;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        alert('Share text copied to clipboard!');
                    }
                } catch (fallbackErr) {
                    console.error('Fallback share error:', fallbackErr);
                    alert('Could not share. Please copy the URL manually: ' + fixedShareUrl);
                }
            }
        });
        
        // Copy button click
        copyBtn.addEventListener('click', () => {
            const name = userName.value.trim() || "Someone";
            const shareMessage = `${name} ${shareDescription}\n${fixedShareUrl}`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareMessage).then(() => {
                    alert('Wish copied to clipboard!');
                }).catch(err => {
                    console.error('Could not copy text: ', err);
                    fallbackCopyText(shareMessage);
                });
            } else {
                fallbackCopyText(shareMessage);
            }
        });
        
        // Fallback copy method for older browsers
        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('Wish copied to clipboard!');
            } catch (err) {
                console.error('Fallback copy failed:', err);
                alert('Could not copy text. Please select and copy manually.');
            }
            
            document.body.removeChild(textArea);
        }
        
        // Handle line breaks in wishes
        function processWishText(text) {
            if (!text) return '';
            return text.replace(/\n/g, '<br>');
        }
        
        // Load settings when page loads
        document.addEventListener('DOMContentLoaded', loadSettings);
    </script>
</body>
</html>
