<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festival Admin Panel</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        .shine {
            background: linear-gradient(90deg, #fff7ae 25%, #ffe066 50%, #fff7ae 75%);
            background-size: 200% 100%;
            animation: shine 2s linear infinite;
        }
        @keyframes shine {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .festive-border {
            border: 4px solid transparent;
            border-image: linear-gradient(90deg, #eab308, #ea580c, #a21caf, #f59e42, #eab308) 1;
        }
        .festive-shadow {
            box-shadow: 0 8px 32px 0 rgba(234, 88, 12, 0.25), 0 1.5px 4px 0 #a21caf33;
        }
        .festive-bg {
            background: linear-gradient(135deg, #fff7ae 0%, #fef3c7 60%, #fde68a 100%);
        }
        .festive-accent {
            background: repeating-linear-gradient(
                135deg,
                #f59e42 0px,
                #f59e42 8px,
                #eab308 8px,
                #eab308 16px
            );
        }
        .festive-underline {
            text-decoration: underline wavy #ea580c 3px;
        }
        .festive-btn {
            background: linear-gradient(90deg, #eab308 0%, #ea580c 100%);
            color: #fff;
        }
        .festive-btn:hover {
            background: linear-gradient(90deg, #ea580c 0%, #eab308 100%);
            color: #fff;
        }
        .toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            opacity: 0;
            transform: translateY(20px);
            animation: slideIn 0.3s forwards, fadeOut 3s 1s forwards;
            z-index: 1000;
        }
        @keyframes slideIn {
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(20px); }
        }
        .custom-editor {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .editor-content {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 600px;
        }
        .custom-option {
            display: none; /* Hidden by default */
            margin-top: 0.5rem;
        }
        /* Show custom option input when its parent select is set to 'custom' */
        select[id$="Font"]:has(option[value="custom"]:checked) ~ input[id$="Font"],
        select[id$="ColorType"]:has(option[value="custom"]:checked) ~ input[id$="Color"],
        select[id$="Size"]:has(option[value="custom"]:checked) ~ input[id$="Size"],
        select[id$="Speed"]:has(option[value="custom"]:checked) ~ input[id$="Speed"],
        select[id$="Quantity"]:has(option[value="custom"]:checked) ~ input[id$="Quantity"],
        select[id$="EmojiType"]:has(option[value="custom"]:checked) ~ input[id$="EmojiType"],
        select[id$="ButtonColorType"]:has(option[value="custom"]:checked) ~ input[id$="ButtonColor"]
        {
            display: block;
        }

        .preview-container img, .preview-container video {
            max-width: 100%;
            max-height: 200px;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 sm:p-6 font-sans bg-gradient-to-br from-yellow-100 via-orange-100 to-purple-100 festive-bg">
    <div class="w-full max-w-5xl rounded-3xl festive-border festive-shadow p-6 sm:p-8 bg-white/90 backdrop-blur-md">
        <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-center text-yellow-700 mb-8 festive-underline shine tracking-wide">
            🎉 Festival Admin Panel 🎉
        </h1>
        
        <!-- Wishes Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-yellow-400 festive-bg festive-shadow">
            <div class="festive-accent p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-purple-800">Wishes</h2>
            </div>
            <div class="p-4 sm:p-6">
                <form id="settingsForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-yellow-800">Title</label>
                        <div class="flex gap-2">
                            <input type="text" id="title" class="flex-1 p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900">
                            <button type="button" onclick="openEditor('title')" class="px-3 bg-yellow-100 rounded-lg border border-yellow-300">Edit</button>
                        </div>
                        <div class="mt-2 grid grid-cols-3 gap-2">
                            <div>
                                <label class="block text-xs font-semibold text-yellow-800">Font</label>
                                <select id="titleFont" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                    <option value="'Poppins', sans-serif">Poppins</option>
                                    <option value="'Noto Sans Devanagari', sans-serif">Noto Sans</option>
                                    <option value="Arial, sans-serif">Arial</option>
                                    <option value="custom">Custom Font</option>
                                </select>
                                <input type="text" id="customTitleFont" placeholder="Enter custom font family" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-yellow-800">Color</label>
                                <select id="titleColorType" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                    <option value="preset">Preset Colors</option>
                                    <option value="custom">Custom Color</option>
                                </select>
                                <input type="color" id="titleColor" value="#4c1d95" class="custom-option w-full h-8">
                                <input type="text" id="customTitleColor" placeholder="Enter hex code" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-yellow-800">Size</label>
                                <select id="titleSize" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                    <option value="text-xl">Small</option>
                                    <option value="text-2xl">Medium</option>
                                    <option value="text-3xl">Large</option>
                                    <option value="text-4xl">X-Large</option>
                                    <option value="text-5xl">XX-Large</option>
                                    <option value="custom">Custom Size</option>
                                </select>
                                <input type="text" id="customTitleSize" placeholder="Enter custom size (e.g., 2rem)" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-yellow-800">Hindi Wish</label>
                            <div class="flex gap-2">
                                <textarea id="hindiWish" class="flex-1 p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900 resize-y h-32"></textarea>
                                <button type="button" onclick="openEditor('hindiWish')" class="px-3 bg-yellow-100 rounded-lg border border-yellow-300">Edit</button>
                            </div>
                            <div class="mt-2 space-y-2">
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">Hindi Font</label>
                                    <select id="hindiFont" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="'Noto Sans Devanagari', sans-serif">Noto Sans Devanagari</option>
                                        <option value="'Poppins', sans-serif">Poppins</option>
                                        <option value="Arial, sans-serif">Arial</option>
                                        <option value="custom">Custom Font</option>
                                    </select>
                                    <input type="text" id="customHindiFont" placeholder="Enter custom font name" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">Hindi Text Color</label>
                                    <select id="hindiColorType" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="preset">Preset Colors</option>
                                        <option value="custom">Custom Color</option>
                                    </select>
                                    <input type="color" id="hindiColor" value="#4c1d95" class="custom-option w-full h-8">
                                    <input type="text" id="customHindiColor" placeholder="Enter hex code" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">Hindi Text Size</label>
                                    <select id="hindiSize" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="1rem">Small</option>
                                        <option value="1.25rem">Medium</option>
                                        <option value="1.5rem">Large</option>
                                        <option value="2rem">X-Large</option>
                                        <option value="2.5rem">XX-Large</option>
                                        <option value="custom">Custom Size</option>
                                    </select>
                                    <input type="text" id="customHindiSize" placeholder="Enter custom size (e.g., 1.8rem)" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-yellow-800">English Wish</label>
                            <div class="flex gap-2">
                                <textarea id="englishWish" class="flex-1 p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900 resize-y h-32"></textarea>
                                <button type="button" onclick="openEditor('englishWish')" class="px-3 bg-yellow-100 rounded-lg border border-yellow-300">Edit</button>
                            </div>
                            <div class="mt-2 space-y-2">
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">English Font</label>
                                    <select id="englishFont" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="'Poppins', sans-serif">Poppins</option>
                                        <option value="Arial, sans-serif">Arial</option>
                                        <option value="Georgia, serif">Georgia</option>
                                        <option value="custom">Custom Font</option>
                                    </select>
                                    <input type="text" id="customEnglishFont" placeholder="Enter custom font name" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">English Text Color</label>
                                    <select id="englishColorType" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="preset">Preset Colors</option>
                                        <option value="custom">Custom Color</option>
                                    </select>
                                    <input type="color" id="englishColor" value="#4c1d95" class="custom-option w-full h-8">
                                    <input type="text" id="customEnglishColor" placeholder="Enter hex code" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">English Text Size</label>
                                    <select id="englishSize" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="1rem">Small</option>
                                        <option value="1.25rem">Medium</option>
                                        <option value="1.5rem">Large</option>
                                        <option value="2rem">X-Large</option>
                                        <option value="2.5rem">XX-Large</option>
                                        <option value="custom">Custom Size</option>
                                    </select>
                                    <input type="text" id="customEnglishSize" placeholder="Enter custom size (e.g., 1.8rem)" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-yellow-800">Share Description</label>
                        <textarea id="shareDescription" class="w-full p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900 resize-y h-16" placeholder="Custom text that will appear when users share"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-yellow-800">Background Color/Image URL</label>
                            <input type="text" id="background" class="w-full p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900" placeholder="Hex color code or image URL">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-yellow-800">Second Page Background</label>
                            <input type="text" id="secondBackground" class="w-full p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900" placeholder="Hex color code or image URL">
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Media Upload Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-purple-400 festive-bg festive-shadow">
            <div class="bg-gradient-to-r from-purple-700 via-pink-500 to-yellow-400 p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-yellow-50">Media Upload</h2>
            </div>
            <div class="p-4 sm:p-6">
                <label class="block text-sm font-semibold text-purple-800 mb-2">Image/Video/GIF (Top Media)</label>
                <div id="mediaDropArea" class="drag-drop p-4 sm:p-6 rounded-lg text-center cursor-pointer border-4 border-dashed border-yellow-400 hover:border-purple-500 bg-gradient-to-br from-yellow-50 to-pink-100 transition-all duration-200">
                    <p id="mediaPlaceholder" class="text-purple-700 flex items-center justify-center gap-2 text-sm sm:text-base">
                        <span>🎨 Drag & drop or click to upload (Image, Video, GIF)</span>
                    </p>
                    <div id="mediaPreview" class="preview-container hidden mt-4"></div>
                    <input type="file" id="media" accept="image/*,video/*,.gif" class="hidden">
                </div>
            </div>
        </div>

        <!-- Frame Image Upload Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-blue-400 festive-bg festive-shadow">
            <div class="bg-gradient-to-r from-blue-600 via-green-400 to-teal-400 p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-white">Frame Image</h2>
            </div>
            <div class="p-4 sm:p-6">
                <label class="block text-sm font-semibold text-blue-800 mb-2">Frame Image (PNG with transparency)</label>
                <div id="frameDropArea" class="drag-drop p-4 sm:p-6 rounded-lg text-center cursor-pointer border-4 border-dashed border-blue-400 hover:border-teal-500 bg-gradient-to-br from-blue-50 to-teal-100 transition-all duration-200">
                    <p id="framePlaceholder" class="text-blue-700 flex items-center justify-center gap-2 text-sm sm:text-base">
                        <span>🖼️ Drag & drop or click to upload frame PNG</span>
                    </p>
                    <div id="framePreview" class="preview-container hidden mt-4"></div>
                    <input type="file" id="frame" accept="image/png" class="hidden">
                </div>
                <div class="mt-4 grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-blue-800">Frame Position</label>
                        <select id="framePosition" class="w-full p-2 sm:p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent bg-blue-50 font-semibold text-blue-900">
                            <option value="cover">Cover (Full)</option>
                            <option value="contain">Contain (Fit)</option>
                            <option value="top">Top Align</option>
                            <option value="bottom">Bottom Align</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-blue-800">Frame Opacity</label>
                        <input type="range" id="frameOpacity" min="0" max="100" value="100" class="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer">
                        <span id="frameOpacityValue" class="text-sm text-blue-700">100%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wish Box Background Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-green-400 festive-bg festive-shadow">
            <div class="bg-gradient-to-r from-green-600 via-teal-400 to-blue-400 p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-white">Wish Box Background</h2>
            </div>
            <div class="p-4 sm:p-6">
                <label class="block text-sm font-semibold text-green-800 mb-2">Wish Box Background Image</label>
                <div id="wishBgDropArea" class="drag-drop p-4 sm:p-6 rounded-lg text-center cursor-pointer border-4 border-dashed border-green-400 hover:border-blue-500 bg-gradient-to-br from-green-50 to-blue-100 transition-all duration-200">
                    <p id="wishBgPlaceholder" class="text-green-700 flex items-center justify-center gap-2 text-sm sm:text-base">
                        <span>🎁 Drag & drop or click to upload wish box background</span>
                    </p>
                    <div id="wishBgPreview" class="preview-container hidden mt-4"></div>
                    <input type="file" id="wishBg" accept="image/*" class="hidden">
                </div>
                <div class="mt-4 grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-green-800">Background Size</label>
                        <select id="wishBgSize" class="w-full p-2 sm:p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:border-transparent bg-green-50 font-semibold text-green-900">
                            <option value="cover">Cover</option>
                            <option value="contain">Contain</option>
                            <option value="auto">Auto</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-green-800">Background Repeat</label>
                        <select id="wishBgRepeat" class="w-full p-2 sm:p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:border-transparent bg-green-50 font-semibold text-green-900">
                            <option value="no-repeat">No Repeat</option>
                            <option value="repeat">Repeat</option>
                            <option value="repeat-x">Repeat X</option>
                            <option value="repeat-y">Repeat Y</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audio Upload Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-orange-400 festive-bg festive-shadow">
            <div class="bg-gradient-to-r from-orange-600 via-yellow-400 to-pink-400 p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-white">Audio Upload</h2>
            </div>
            <div class="p-4 sm:p-6">
                <label class="block text-sm font-semibold text-orange-800 mb-2">Background Audio</label>
                <div id="audioDropArea" class="drag-drop p-4 sm:p-6 rounded-lg text-center cursor-pointer border-4 border-dashed border-orange-400 hover:border-pink-500 bg-gradient-to-br from-yellow-50 to-orange-100 transition-all duration-200">
                    <p id="audioPlaceholder" class="text-orange-700 flex items-center justify-center gap-2 text-sm sm:text-base">
                        <span>🎵 Drag & drop or click to upload (Audio)</span>
                    </p>
                    <div id="audioPreview" class="preview-container hidden mt-4"></div>
                    <input type="file" id="audio" accept="audio/*" class="hidden">
                </div>
            </div>
        </div>

        <!-- Effects Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-pink-400 festive-bg festive-shadow">
            <div class="bg-gradient-to-r from-pink-600 via-yellow-400 to-purple-500 p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-white">Effects & Design</h2>
            </div>
            <div class="p-4 sm:p-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Autoplay Audio</label>
                        <select id="autoplay" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="true">True</option>
                            <option value="false">False</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Animation Type</label>
                        <select id="animationType" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="float">Floating Emojis</option>
                            <option value="fall">Falling Emojis</option>
                            <option value="swirl">Swirling Emojis</option>
                            <option value="fireworks">Fireworks</option>
                            <option value="confetti">Confetti</option>
                            <option value="custom">Custom Animation</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Animation Speed</label>
                        <select id="animationSpeed" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="0.5">Very Slow (0.5x)</option>
                            <option value="0.75">Slow (0.75x)</option>
                            <option value="1" selected>Normal (1x)</option>
                            <option value="1.5">Fast (1.5x)</option>
                            <option value="2">Very Fast (2x)</option>
                            <option value="custom">Custom Speed</option>
                        </select>
                        <input type="number" id="customSpeed" placeholder="Enter custom speed" step="0.1" min="0.1" max="5" class="custom-option w-full p-2 border border-pink-200 rounded-lg bg-pink-50 text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Animation Quantity</label>
                        <select id="animationQuantity" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="very-high">Very High</option>
                            <option value="custom">Custom</option>
                        </select>
                        <input type="number" id="customQuantity" placeholder="Enter quantity" min="1" max="100" class="custom-option w-full p-2 border border-pink-200 rounded-lg bg-pink-50 text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Emoji Type</label>
                        <select id="emojiType" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="flowers">Flowers</option>
                            <option value="diyas">Diyas</option>
                            <option value="rangoli">Rangoli</option>
                            <option value="festive">Festive Symbols</option>
                            <option value="hearts">Hearts</option>
                            <option value="stars">Stars</option>
                            <option value="mixed">Mixed</option>
                            <option value="custom">Custom Emojis</option>
                        </select>
                        <input type="text" id="customEmojis" placeholder="Enter emojis separated by commas" class="custom-option w-full p-2 border border-pink-200 rounded-lg bg-pink-50 text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Animation Enable</label>
                        <select id="animationEnable" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="true">True</option>
                            <option value="false">False</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Button Style</label>
                        <select id="buttonStyle" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="gradient">Gradient</option>
                            <option value="solid">Solid Color</option>
                            <option value="outline">Outline</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Button Color</label>
                        <select id="buttonColorType" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="preset">Preset Colors</option>
                            <option value="custom">Custom Color</option>
                        </select>
                        <input type="color" id="buttonColor" value="#eab308" class="custom-option w-full h-8">
                        <input type="text" id="customButtonColor" placeholder="Enter hex code" class="custom-option w-full p-2 border border-pink-200 rounded-lg bg-pink-50 text-sm">
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6 mt-6 sm:mt-8">
            <button type="submit" form="settingsForm" class="festive-btn px-8 py-3 rounded-full font-bold shadow-xl text-lg transition-all hover:scale-105">💾 Save</button>
            <button type="button" id="resetBtn" class="bg-gradient-to-r from-gray-600 to-gray-800 text-white px-8 py-3 rounded-full font-bold shadow-xl text-lg transition-all hover:scale-105">🔄 Reset</button>
        </div>
    </div>

    <!-- Custom Editor Modal -->
    <div id="customEditor" class="custom-editor">
        <div class="editor-content">
            <h3 class="text-xl font-bold mb-4" id="editorTitle">Edit Content</h3>
            <textarea id="editorTextarea" class="w-full p-3 border border-gray-300 rounded-lg h-40"></textarea>
            <div class="mt-4 flex justify-end gap-3">
                <button id="cancelEdit" class="px-4 py-2 bg-gray-200 rounded-lg">Cancel</button>
                <button id="saveEdit" class="px-4 py-2 bg-blue-500 text-white rounded-lg">Save</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase Client Initialization
        const supabaseUrl = 'https://udupfqyxsxfmcekumrph.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVkdXBmcXl4c3hmbWNla3VtcnBoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1NTgxOTYsImV4cCI6MjA2NjEzNDE5Nn0.-ndlXo0XeRrzONovcOeiMZxeYY4st7XUXyVdWZVbZJs';
        const supaClient = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Custom Editor Functionality
        let currentEditorField = ''; // To keep track of which field is being edited
        function openEditor(fieldId) {
            currentEditorField = fieldId;
            const field = document.getElementById(fieldId);
            document.getElementById('editorTextarea').value = field.value; // Load current value into editor
            document.getElementById('editorTitle').textContent = `Edit ${fieldId.replace(/([A-Z])/g, ' $1')}`; // Set editor title
            document.getElementById('customEditor').style.display = 'flex'; // Show the editor modal
        }

        // Save button in editor modal
        document.getElementById('saveEdit').addEventListener('click', function() {
            const value = document.getElementById('editorTextarea').value;
            document.getElementById(currentEditorField).value = value; // Update the original input field
            document.getElementById('customEditor').style.display = 'none'; // Hide the modal
        });

        // Cancel button in editor modal
        document.getElementById('cancelEdit').addEventListener('click', function() {
            document.getElementById('customEditor').style.display = 'none'; // Hide the modal without saving
        });

        // Setup custom option visibility toggles for select elements
        function setupCustomOptions() {
            // Font selectors: show custom input if 'Custom Font' is selected
            document.querySelectorAll('select[id$="Font"]').forEach(select => {
                select.addEventListener('change', function() {
                    const customInput = document.getElementById(`custom${this.id}`);
                    if (this.value === 'custom') {
                        if (customInput) customInput.classList.remove('hidden'); // Show input
                    } else {
                        if (customInput) customInput.classList.add('hidden'); // Hide input
                    }
                });
            });
            
            // Color type selectors: show color picker and custom input if 'Custom Color' is selected
            document.querySelectorAll('select[id$="ColorType"]').forEach(select => {
                select.addEventListener('change', function() {
                    const colorInput = document.getElementById(this.id.replace('Type', '')); // The preset color input
                    const customColorInput = document.getElementById(`custom${this.id.replace('Type', '')}`); // The custom color input
                    
                    if (this.value === 'custom') {
                        if (colorInput) colorInput.classList.remove('hidden');
                        if (customColorInput) customColorInput.classList.remove('hidden');
                    } else {
                        if (colorInput) colorInput.classList.add('hidden');
                        if (customColorInput) customColorInput.classList.add('hidden');
                    }
                });
            });
            
            // Other custom options: show input if 'Custom' is selected for the respective option
            document.getElementById('animationSpeed').addEventListener('change', function() {
                document.getElementById('customSpeed').classList.toggle('hidden', this.value !== 'custom');
            });
            
            document.getElementById('animationQuantity').addEventListener('change', function() {
                document.getElementById('customQuantity').classList.toggle('hidden', this.value !== 'custom');
            });
            
            document.getElementById('emojiType').addEventListener('change', function() {
                document.getElementById('customEmojis').classList.toggle('hidden', this.value !== 'custom');
            });
            
            // Size selectors for text
            document.getElementById('titleSize').addEventListener('change', function() {
                document.getElementById('customTitleSize').classList.toggle('hidden', this.value !== 'custom');
            });
            
            document.getElementById('hindiSize').addEventListener('change', function() {
                document.getElementById('customHindiSize').classList.toggle('hidden', this.value !== 'custom');
            });

            document.getElementById('englishSize').addEventListener('change', function() {
                document.getElementById('customEnglishSize').classList.toggle('hidden', this.value !== 'custom');
            });
            
            // Button color type selector
            document.getElementById('buttonColorType').addEventListener('change', function() {
                const buttonColor = document.getElementById('buttonColor');
                const customButtonColor = document.getElementById('customButtonColor');
                if (this.value === 'custom') {
                    if (buttonColor) buttonColor.classList.remove('hidden');
                    if (customButtonColor) customButtonColor.classList.remove('hidden');
                } else {
                    if (buttonColor) buttonColor.classList.add('hidden');
                    if (customButtonColor) customButtonColor.classList.add('hidden');
                }
            });

            // Frame opacity slider value display
            document.getElementById('frameOpacity').addEventListener('input', function() {
                document.getElementById('frameOpacityValue').textContent = `${this.value}%`;
            });
        }

        // Load saved settings from Supabase
        async function loadSettings() {
            try {
                const { data, error } = await supaClient
                    .from('settings')
                    .select('value')
                    .eq('id', 'festival_settings')
                    .single();
                
                if (data && data.value) {
                    const savedValue = data.value;
                    // Iterate over saved settings and populate form elements
                    Object.keys(savedValue).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            if (element.type === 'checkbox') { // Handle checkboxes if any
                                element.checked = savedValue[key];
                            } else {
                                element.value = savedValue[key]; // Set value for other input types
                            }
                        }
                    });
                    
                    // After populating values, trigger change events on relevant selects to correctly show/hide custom inputs
                    document.getElementById('titleFont').dispatchEvent(new Event('change'));
                    document.getElementById('hindiFont').dispatchEvent(new Event('change'));
                    document.getElementById('englishFont').dispatchEvent(new Event('change'));
                    document.getElementById('animationSpeed').dispatchEvent(new Event('change'));
                    document.getElementById('animationQuantity').dispatchEvent(new Event('change'));
                    document.getElementById('emojiType').dispatchEvent(new Event('change'));
                    document.getElementById('titleColorType').dispatchEvent(new Event('change'));
                    document.getElementById('hindiColorType').dispatchEvent(new Event('change'));
                    document.getElementById('englishColorType').dispatchEvent(new Event('change'));
                    document.getElementById('buttonColorType').dispatchEvent(new Event('change'));
                    document.getElementById('titleSize').dispatchEvent(new Event('change'));
                    document.getElementById('hindiSize').dispatchEvent(new Event('change'));
                    document.getElementById('englishSize').dispatchEvent(new Event('change'));
                    
                    // Explicitly ensure custom color inputs are visible if 'custom' was selected
                    if (savedValue.titleColorType === 'custom') {
                        document.getElementById('titleColor').classList.remove('hidden');
                        document.getElementById('customTitleColor').classList.remove('hidden');
                    }
                    if (savedValue.hindiColorType === 'custom') {
                        document.getElementById('hindiColor').classList.remove('hidden');
                        document.getElementById('customHindiColor').classList.remove('hidden');
                    }
                    if (savedValue.englishColorType === 'custom') {
                        document.getElementById('englishColor').classList.remove('hidden');
                        document.getElementById('customEnglishColor').classList.remove('hidden');
                    }
                    if (savedValue.buttonColorType === 'custom') {
                        document.getElementById('buttonColor').classList.remove('hidden');
                        document.getElementById('customButtonColor').classList.remove('hidden');
                    }

                    // Load media previews if URLs exist in saved settings
                    if (savedValue.mediaUrl) {
                        const mediaPreview = document.getElementById('mediaPreview');
                        mediaPreview.innerHTML = ''; // Clear placeholder content
                        mediaPreview.classList.remove('hidden');
                        document.getElementById('mediaPlaceholder').classList.add('hidden');
                        
                        // Create either an img or video element based on URL
                        const mediaElement = savedValue.mediaUrl.includes('.mp4') || savedValue.mediaUrl.includes('.webm') 
                            ? document.createElement('video') 
                            : document.createElement('img');
                        mediaElement.src = savedValue.mediaUrl;
                        if(mediaElement.tagName === 'VIDEO') {
                            mediaElement.controls = true; // Show controls for video
                            mediaElement.style.width = '100%';
                            mediaElement.style.height = 'auto';
                        }
                        mediaPreview.appendChild(mediaElement);
                    }
                    
                    // Load audio preview if URL exists
                    if (savedValue.audioUrl) {
                        const audioPreview = document.getElementById('audioPreview');
                        audioPreview.innerHTML = '';
                        audioPreview.classList.remove('hidden');
                        document.getElementById('audioPlaceholder').classList.add('hidden');
                        
                        const audioDiv = document.createElement('div');
                        audioDiv.className = 'audio-preview flex items-center gap-2';
                        const playBtn = document.createElement('button');
                        playBtn.textContent = '▶';
                        playBtn.className = 'bg-purple-600 text-white p-2 rounded-full hover:bg-purple-700 text-sm';
                        const fileName = document.createElement('span');
                        fileName.textContent = 'Background Audio'; // Display a generic name for audio
                        fileName.className = 'text-gray-800 text-sm';
                        const audio = new Audio(savedValue.audioUrl); // Create audio object for playback on click
                        playBtn.addEventListener('click', () => audio.play());
                        audioDiv.appendChild(playBtn);
                        audioDiv.appendChild(fileName);
                        audioPreview.appendChild(audioDiv);
                    }

                    // Load frame image preview if URL exists
                    if (savedValue.frameUrl) {
                        const framePreview = document.getElementById('framePreview');
                        framePreview.innerHTML = '';
                        framePreview.classList.remove('hidden');
                        document.getElementById('framePlaceholder').classList.add('hidden');
                        
                        const img = document.createElement('img');
                        img.src = savedValue.frameUrl;
                        framePreview.appendChild(img);
                    }

                    // Load wish box background preview if URL exists
                    if (savedValue.wishBgUrl) {
                        const wishBgPreview = document.getElementById('wishBgPreview');
                        wishBgPreview.innerHTML = '';
                        wishBgPreview.classList.remove('hidden');
                        document.getElementById('wishBgPlaceholder').classList.add('hidden');
                        
                        const img = document.createElement('img');
                        img.src = savedValue.wishBgUrl;
                        wishBgPreview.appendChild(img);
                    }

                    // Update frame opacity display
                    if (savedValue.frameOpacity !== undefined) {
                        document.getElementById('frameOpacity').value = savedValue.frameOpacity;
                        document.getElementById('frameOpacityValue').textContent = `${savedValue.frameOpacity}%`;
                    }
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                // Optionally display a user-friendly error message here
            }
        }

        // Show toast notifications (e.g., for save/reset success/error)
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`; // Style based on type
            toast.textContent = message;
            document.body.appendChild(toast); // Add toast to the body
            setTimeout(() => toast.remove(), 4000); // Remove toast after 4 seconds
        }

        // Setup drag-and-drop functionality for file upload areas
        function setupDragAndDrop(dropArea, input, preview, placeholder, accept = null) {
            // Prevent default browser behaviors for drag events
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            // Add/remove CSS class to visually indicate drop area is active
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => dropArea.classList.add('drag-over'), false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => dropArea.classList.remove('drag-over'), false);
            });

            // Handle file drop event
            dropArea.addEventListener('drop', (e) => {
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    // Validate file type
                    if (file && (!accept || file.type.match(accept))) {
                        input.files = e.dataTransfer.files; // Assign dropped files to the hidden file input
                        displayPreview(file, preview, placeholder, input.accept); // Show preview
                    } else {
                        alert(`Invalid file type. Please upload a file of type: ${accept}`); // Alert on invalid type
                    }
                }
            });

            // Allow clicking on the drop area to trigger the file input
            dropArea.addEventListener('click', () => input.click());

            // Handle file selection via the file input's change event
            input.addEventListener('change', () => {
                if (input.files.length > 0) {
                    const file = input.files[0];
                    // Validate file type
                    if (file && (!accept || file.type.match(accept))) {
                        displayPreview(file, preview, placeholder, input.accept); // Show preview
                    } else {
                        alert(`Invalid file type. Please upload a file of type: ${accept}`);
                        input.value = ''; // Clear the input if file type is wrong
                    }
                }
            });
        }

        // Display a preview of the selected file
        function displayPreview(file, preview, placeholder, accept) {
            preview.innerHTML = ''; // Clear any previous preview
            placeholder.classList.add('hidden'); // Hide placeholder text
            preview.classList.remove('hidden'); // Show preview area

            const reader = new FileReader();
            reader.onload = function(e) { // Called when file is read
                if (accept.includes('image') && file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = e.target.result; // Set image source from file reader
                    img.style.width = '100%'; img.style.height = 'auto'; // Make image responsive
                    preview.appendChild(img);
                } else if (accept.includes('video') && file.type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = e.target.result; // Set video source
                    video.controls = true; // Show video controls
                    video.style.width = '100%'; video.style.height = 'auto';
                    video.style.display = 'block';
                    preview.appendChild(video);
                } else if (accept.includes('audio') && file.type.startsWith('audio/')) {
                    // Display audio player controls (simplified)
                    const audioDiv = document.createElement('div');
                    audioDiv.className = 'audio-preview flex items-center gap-2';
                    const playBtn = document.createElement('button');
                    playBtn.textContent = '▶';
                    playBtn.className = 'bg-purple-600 text-white p-2 rounded-full hover:bg-purple-700 text-sm';
                    const fileName = document.createElement('span');
                    fileName.textContent = 'Background Audio'; // Generic name
                    fileName.className = 'text-gray-800 text-sm';
                    const audio = new Audio(e.target.result); // Create an audio object for playback
                    playBtn.addEventListener('click', () => audio.play());
                    audioDiv.appendChild(playBtn);
                    audioDiv.appendChild(fileName);
                    preview.appendChild(audioDiv);
                }
            };
            reader.readAsDataURL(file); // Read the file as a data URL for preview
        }

        // Setup drag-and-drop for all designated areas on page load
        setupDragAndDrop(
            document.getElementById('mediaDropArea'),
            document.getElementById('media'),
            document.getElementById('mediaPreview'),
            document.getElementById('mediaPlaceholder')
        );

        setupDragAndDrop(
            document.getElementById('frameDropArea'),
            document.getElementById('frame'),
            document.getElementById('framePreview'),
            document.getElementById('framePlaceholder'),
            'image/png' // Specifically accept only PNG for frames
        );

        setupDragAndDrop(
            document.getElementById('wishBgDropArea'),
            document.getElementById('wishBg'),
            document.getElementById('wishBgPreview'),
            document.getElementById('wishBgPlaceholder')
        );

        setupDragAndDrop(
            document.getElementById('audioDropArea'),
            document.getElementById('audio'),
            document.getElementById('audioPreview'),
            document.getElementById('audioPlaceholder')
        );

        // Function to upload a file to Supabase Storage
        async function uploadFile(file, folder) {
            if (!file) return null; // Return null if no file is provided
            const fileExt = file.name.split('.').pop(); // Get file extension
            const fileName = `${Date.now()}.${fileExt}`; // Create a unique filename
            const filePath = `${folder}/${fileName}`; // Define the path in Supabase Storage
            
            try {
                const { data, error } = await supaClient.storage
                    .from('festivalmedia') // Your Supabase bucket name
                    .upload(filePath, file); // Upload the file
                
                if (error) throw error; // Throw error if upload fails
                
                // Get the public URL of the uploaded file
                const publicUrl = supaClient.storage.from('festivalmedia').getPublicUrl(filePath).data.publicUrl;
                return publicUrl;
            } catch (error) {
                console.error('Error uploading file:', error);
                throw error; // Re-throw error to be handled by the submit handler
            }
        }

        // Handle the form submission for saving settings
        document.getElementById('settingsForm').addEventListener('submit', async (e) => {
            e.preventDefault(); // Prevent default form submission
            
            const submitButton = document.querySelector('button[type="submit"]');
            submitButton.disabled = true; // Disable button to prevent double submission
            submitButton.textContent = 'Saving...'; // Update button text

            try {
                // Get the file objects from the inputs
                const mediaFile = document.getElementById('media').files[0];
                const audioFile = document.getElementById('audio').files[0];
                const frameFile = document.getElementById('frame').files[0];
                const wishBgFile = document.getElementById('wishBg').files[0];

                // Upload all files concurrently for better performance
                const [mediaUrl, audioUrl, frameUrl, wishBgUrl] = await Promise.all([
                    uploadFile(mediaFile, 'media'),
                    uploadFile(audioFile, 'audio'),
                    uploadFile(frameFile, 'frames'),
                    uploadFile(wishBgFile, 'wishbg')
                ]);

                // Retrieve existing URLs from preview elements if no new file was uploaded
                const existingMediaUrl = document.getElementById('mediaPreview').querySelector('img, video')?.src || null;
                const existingAudioUrl = document.getElementById('audioPreview').querySelector('audio')?.src || null;
                const existingFrameUrl = document.getElementById('framePreview').querySelector('img')?.src || null;
                const existingWishBgUrl = document.getElementById('wishBgPreview').querySelector('img')?.src || null;
                
                // Determine the final URLs to save, prioritizing newly uploaded files
                const finalMediaUrl = mediaUrl || existingMediaUrl || null;
                const finalAudioUrl = audioUrl || existingAudioUrl || null;
                const finalFrameUrl = frameUrl || existingFrameUrl || null;
                const finalWishBgUrl = wishBgUrl || existingWishBgUrl || null;
                
                // Collect all settings from the form inputs
                const settings = {
                    title: document.getElementById('title').value,
                    hindiWish: document.getElementById('hindiWish').value,
                    englishWish: document.getElementById('englishWish').value,
                    shareDescription: document.getElementById('shareDescription').value,
                    background: document.getElementById('background').value,
                    secondBackground: document.getElementById('secondBackground').value,
                    
                    mediaUrl: finalMediaUrl,
                    audioUrl: finalAudioUrl,
                    frameUrl: finalFrameUrl,
                    wishBgUrl: finalWishBgUrl,
                    
                    framePosition: document.getElementById('framePosition').value,
                    frameOpacity: document.getElementById('frameOpacity').value,
                    wishBgSize: document.getElementById('wishBgSize').value,
                    wishBgRepeat: document.getElementById('wishBgRepeat').value,
                    
                    autoplay: document.getElementById('autoplay').value === 'true', // Convert string to boolean
                    animationType: document.getElementById('animationType').value,
                    animationSpeed: document.getElementById('animationSpeed').value === 'custom' ? 
                        document.getElementById('customSpeed').value : document.getElementById('animationSpeed').value, // Use custom value if selected
                    animationQuantity: document.getElementById('animationQuantity').value === 'custom' ? 
                        document.getElementById('customQuantity').value : document.getElementById('animationQuantity').value, // Use custom value if selected
                    emojiType: document.getElementById('emojiType').value,
                    customEmojis: document.getElementById('emojiType').value === 'custom' ? 
                        document.getElementById('customEmojis').value : null, // Save custom emojis only if type is custom
                    animationEnable: document.getElementById('animationEnable').value === 'true', // Convert string to boolean
                    
                    buttonStyle: document.getElementById('buttonStyle').value,
                    buttonColor: document.getElementById('buttonColorType').value === 'custom' ? 
                        document.getElementById('customButtonColor').value : document.getElementById('buttonColor').value, // Use custom color if selected
                    customButtonColor: document.getElementById('buttonColorType').value === 'custom' ? 
                        document.getElementById('customButtonColor').value : null, // Save custom color if type is custom
                        
                    titleFont: document.getElementById('titleFont').value,
                    customTitleFont: document.getElementById('titleFont').value === 'custom' ? 
                        document.getElementById('customTitleFont').value : null, // Save custom font if type is custom
                    titleColor: document.getElementById('titleColorType').value === 'custom' ? 
                        document.getElementById('customTitleColor').value : document.getElementById('titleColor').value, // Use custom color if selected
                    customTitleColor: document.getElementById('titleColorType').value === 'custom' ? 
                        document.getElementById('customTitleColor').value : null, // Save custom color if type is custom
                    titleSize: document.getElementById('titleSize').value === 'custom' ? 
                        document.getElementById('customTitleSize').value : document.getElementById('titleSize').value, // Use custom size value if selected
                    customTitleSize: document.getElementById('titleSize').value === 'custom' ? 
                        document.getElementById('customTitleSize').value : null, // Save custom size value if type is custom
                        
                    hindiFont: document.getElementById('hindiFont').value,
                    customHindiFont: document.getElementById('hindiFont').value === 'custom' ? 
                        document.getElementById('customHindiFont').value : null, // Save custom font if type is custom
                    hindiColor: document.getElementById('hindiColorType').value === 'custom' ? 
                        document.getElementById('customHindiColor').value : document.getElementById('hindiColor').value, // Use custom color if selected
                    customHindiColor: document.getElementById('hindiColorType').value === 'custom' ? 
                        document.getElementById('customHindiColor').value : null, // Save custom color if type is custom
                    hindiSize: document.getElementById('hindiSize').value === 'custom' ? 
                        document.getElementById('customHindiSize').value : document.getElementById('hindiSize').value, // Use custom size value if selected
                    customHindiSize: document.getElementById('hindiSize').value === 'custom' ? 
                        document.getElementById('customHindiSize').value : null, // Save custom size value if type is custom
                        
                    englishFont: document.getElementById('englishFont').value,
                    customEnglishFont: document.getElementById('englishFont').value === 'custom' ? 
                        document.getElementById('customEnglishFont').value : null, // Save custom font if type is custom
                    englishColor: document.getElementById('englishColorType').value === 'custom' ? 
                        document.getElementById('customEnglishColor').value : document.getElementById('englishColor').value, // Use custom color if selected
                    customEnglishColor: document.getElementById('englishColorType').value === 'custom' ? 
                        document.getElementById('customEnglishColor').value : null, // Save custom color if type is custom
                    englishSize: document.getElementById('englishSize').value === 'custom' ? 
                        document.getElementById('customEnglishSize').value : document.getElementById('englishSize').value, // Use custom size value if selected
                    customEnglishSize: document.getElementById('englishSize').value === 'custom' ? 
                        document.getElementById('customEnglishSize').value : null // Save custom size value if type is custom
                };

                // Upsert (insert or update) the settings record in the 'settings' table in Supabase
                const { error: upsertError } = await supaClient
                    .from('settings')
                    .upsert({ id: 'festival_settings', value: settings }); // 'id' is the primary key
                
                if (upsertError) throw upsertError; // Throw error if upsert operation fails
                
                showToast('Settings saved successfully!', 'success'); // Display success message
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('Error saving settings: ' + error.message, 'error'); // Display error message
            } finally {
                // Re-enable the submit button and reset its text, regardless of success or failure
                submitButton.disabled = false;
                submitButton.textContent = '💾 Save';
            }
        });

        // Handle the reset button click to revert settings to default
        document.getElementById('resetBtn').addEventListener('click', async () => {
            // Ask for confirmation before resetting
            if (!confirm('Are you sure you want to reset all settings to default? This action cannot be undone.')) {
                return; // Exit if the user cancels
            }
            try {
                // Delete the settings record from Supabase
                const { error } = await supaClient
                    .from('settings')
                    .delete()
                    .eq('id', 'festival_settings'); // Target the specific settings record
                if (error) throw error; // Throw error if deletion fails
                
                showToast('Settings reset successfully!', 'success'); // Show success message
                
                // Reset the form to its initial state (clears inputs and resets selects)
                document.getElementById('settingsForm').reset();
                
                // Clear all preview areas and hide them
                document.querySelectorAll('.preview-container').forEach(pc => {
                    pc.innerHTML = '';
                    pc.classList.add('hidden');
                });
                
                // Show all placeholder texts again
                document.querySelectorAll('.drag-drop p').forEach(p => {
                    p.classList.remove('hidden');
                });
                
                // Clear all file input values
                document.querySelectorAll('input[type="file"]').forEach(fileInput => {
                    fileInput.value = '';
                });
                
                // Hide all custom option inputs initially
                document.querySelectorAll('.custom-option').forEach(el => {
                    el.classList.add('hidden');
                });
                
                // Re-run setupCustomOptions to ensure default states are applied correctly after reset
                setupCustomOptions();

                // Explicitly reset select values to their defaults (or first option)
                document.getElementById('titleFont').value = "'Poppins', sans-serif";
                document.getElementById('hindiFont').value = "'Noto Sans Devanagari', sans-serif";
                document.getElementById('englishFont').value = "'Poppins', sans-serif";
                document.getElementById('animationSpeed').value = "1";
                document.getElementById('animationQuantity').value = "medium";
                document.getElementById('emojiType').value = "flowers";
                document.getElementById('titleColorType').value = "preset";
                document.getElementById('hindiColorType').value = "preset";
                document.getElementById('englishColorType').value = "preset";
                document.getElementById('buttonColorType').value = "preset";
                document.getElementById('titleSize').value = "text-3xl";
                document.getElementById('hindiSize').value = "1.5rem"; // Reset to default size
                document.getElementById('englishSize').value = "1.5rem"; // Reset to default size
                document.getElementById('framePosition').value = "cover";
                document.getElementById('frameOpacity').value = "100";
                document.getElementById('frameOpacityValue').textContent = "100%";
                document.getElementById('wishBgSize').value = "cover";
                document.getElementById('wishBgRepeat').value = "no-repeat";
                
            } catch (error) {
                console.error('Error resetting settings:', error);
                showToast('Error resetting settings: ' + error.message, 'error');
            }
        });

        // Initialize the application when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            setupCustomOptions(); // Set up the event listeners for custom option visibility
            loadSettings(); // Load saved settings from Supabase
        });
    </script>
</body>
</html>