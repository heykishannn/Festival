<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festival Admin Panel</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        .shine {
            background: linear-gradient(90deg, #fff7ae 25%, #ffe066 50%, #fff7ae 75%);
            background-size: 200% 100%;
            animation: shine 2s linear infinite;
        }
        @keyframes shine {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .festive-border {
            border: 4px solid transparent;
            border-image: linear-gradient(90deg, #eab308, #ea580c, #a21caf, #f59e42, #eab308) 1;
        }
        .festive-shadow {
            box-shadow: 0 8px 32px 0 rgba(234, 88, 12, 0.25), 0 1.5px 4px 0 #a21caf33;
        }
        .festive-bg {
            background: linear-gradient(135deg, #fff7ae 0%, #fef3c7 60%, #fde68a 100%);
        }
        .festive-accent {
            background: repeating-linear-gradient(
                135deg,
                #f59e42 0px,
                #f59e42 8px,
                #eab308 8px,
                #eab308 16px
            );
        }
        .festive-underline {
            text-decoration: underline wavy #ea580c 3px;
        }
        .festive-btn {
            background: linear-gradient(90deg, #eab308 0%, #ea580c 100%);
            color: #fff;
        }
        .festive-btn:hover {
            background: linear-gradient(90deg, #ea580c 0%, #eab308 100%);
            color: #fff;
        }
        .toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            opacity: 0;
            transform: translateY(20px);
            animation: slideIn 0.3s forwards, fadeOut 3s 1s forwards;
            z-index: 1000;
        }
        @keyframes slideIn {
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(20px); }
        }
        .custom-editor {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .editor-content {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 600px;
        }
        .custom-option {
            display: none; /* Hidden by default */
            margin-top: 0.5rem;
        }
        /* Show custom option input when its parent select is set to 'custom' */
        select[id$="Font"]:has(option[value="custom"]:checked) ~ input[id$="Font"],
        select[id$="ColorType"]:has(option[value="custom"]:checked) ~ input[id$="Color"],
        select[id$="Size"]:has(option[value="custom"]:checked) ~ input[id$="Size"],
        select[id$="Speed"]:has(option[value="custom"]:checked) ~ input[id$="Speed"],
        select[id$="Quantity"]:has(option[value="custom"]:checked) ~ input[id$="Quantity"],
        select[id$="EmojiType"]:has(option[value="custom"]:checked) ~ input[id$="EmojiType"],
        select[id$="ButtonColorType"]:has(option[value="custom"]:checked) ~ input[id$="ButtonColor"]
        {
            display: block;
        }

        .preview-container img, .preview-container video {
            max-width: 100%;
            max-height: 200px;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 sm:p-6 font-sans bg-gradient-to-br from-yellow-100 via-orange-100 to-purple-100 festive-bg">
    <div class="w-full max-w-5xl rounded-3xl festive-border festive-shadow p-6 sm:p-8 bg-white/90 backdrop-blur-md">
        <h1 class="text-3xl sm:4xl md:text-5xl font-extrabold text-center text-yellow-700 mb-8 festive-underline shine tracking-wide">
            üéâ Festival Admin Panel üéâ
        </h1>
        
        <!-- Wishes Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-yellow-400 festive-bg festive-shadow">
            <div class="festive-accent p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-purple-800">Wishes</h2>
            </div>
            <div class="p-4 sm:p-6">
                <form id="settingsForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-yellow-800">Title</label>
                        <div class="flex gap-2">
                            <input type="text" id="title" class="flex-1 p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900">
                            <button type="button" onclick="openEditor('title')" class="px-3 bg-yellow-100 rounded-lg border border-yellow-300">Edit</button>
                        </div>
                        <div class="mt-2 grid grid-cols-3 gap-2">
                            <div>
                                <label class="block text-xs font-semibold text-yellow-800">Font</label>
                                <select id="titleFont" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                    <option value="'Poppins', sans-serif">Poppins</option>
                                    <option value="'Noto Sans Devanagari', sans-serif">Noto Sans</option>
                                    <option value="Arial, sans-serif">Arial</option>
                                    <option value="custom">Custom Font</option>
                                </select>
                                <input type="text" id="customTitleFont" placeholder="Enter custom font family" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-yellow-800">Color</label>
                                <select id="titleColorType" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                    <option value="preset">Preset Colors</option>
                                    <option value="custom">Custom Color</option>
                                </select>
                                <input type="color" id="titleColor" value="#4c1d95" class="custom-option w-full h-8">
                                <input type="text" id="customTitleColor" placeholder="Enter hex code" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-yellow-800">Size</label>
                                <select id="titleSize" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                    <option value="text-xl">Small</option>
                                    <option value="text-2xl">Medium</option>
                                    <option value="text-3xl">Large</option>
                                    <option value="text-4xl">X-Large</option>
                                    <option value="text-5xl">XX-Large</option>
                                    <option value="custom">Custom Size</option>
                                </select>
                                <input type="text" id="customTitleSize" placeholder="Enter custom size (e.g., 2rem)" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-yellow-800">Hindi Wish</label>
                            <div class="flex gap-2">
                                <textarea id="hindiWish" class="flex-1 p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900 resize-y h-32"></textarea>
                                <button type="button" onclick="openEditor('hindiWish')" class="px-3 bg-yellow-100 rounded-lg border border-yellow-300">Edit</button>
                            </div>
                            <div class="mt-2 space-y-2">
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">Hindi Font</label>
                                    <select id="hindiFont" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="'Noto Sans Devanagari', sans-serif">Noto Sans Devanagari</option>
                                        <option value="'Poppins', sans-serif">Poppins</option>
                                        <option value="Arial, sans-serif">Arial</option>
                                        <option value="custom">Custom Font</option>
                                    </select>
                                    <input type="text" id="customHindiFont" placeholder="Enter custom font name" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">Hindi Text Color</label>
                                    <select id="hindiColorType" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="preset">Preset Colors</option>
                                        <option value="custom">Custom Color</option>
                                    </select>
                                    <input type="color" id="hindiColor" value="#4c1d95" class="custom-option w-full h-8">
                                    <input type="text" id="customHindiColor" placeholder="Enter hex code" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">Hindi Text Size</label>
                                    <select id="hindiSize" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="1rem">Small</option>
                                        <option value="1.25rem">Medium</option>
                                        <option value="1.5rem">Large</option>
                                        <option value="2rem">X-Large</option>
                                        <option value="2.5rem">XX-Large</option>
                                        <option value="custom">Custom Size</option>
                                    </select>
                                    <input type="text" id="customHindiSize" placeholder="Enter custom size (e.g., 1.8rem)" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-yellow-800">English Wish</label>
                            <div class="flex gap-2">
                                <textarea id="englishWish" class="flex-1 p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900 resize-y h-32"></textarea>
                                <button type="button" onclick="openEditor('englishWish')" class="px-3 bg-yellow-100 rounded-lg border border-yellow-300">Edit</button>
                            </div>
                            <div class="mt-2 space-y-2">
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">English Font</label>
                                    <select id="englishFont" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="'Poppins', sans-serif">Poppins</option>
                                        <option value="Arial, sans-serif">Arial</option>
                                        <option value="Georgia, serif">Georgia</option>
                                        <option value="custom">Custom Font</option>
                                    </select>
                                    <input type="text" id="customEnglishFont" placeholder="Enter custom font name" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">English Text Color</label>
                                    <select id="englishColorType" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="preset">Preset Colors</option>
                                        <option value="custom">Custom Color</option>
                                    </select>
                                    <input type="color" id="englishColor" value="#4c1d95" class="custom-option w-full h-8">
                                    <input type="text" id="customEnglishColor" placeholder="Enter hex code" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-yellow-800">English Text Size</label>
                                    <select id="englishSize" class="w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                        <option value="1rem">Small</option>
                                        <option value="1.25rem">Medium</option>
                                        <option value="1.5rem">Large</option>
                                        <option value="2rem">X-Large</option>
                                        <option value="2.5rem">XX-Large</option>
                                        <option value="custom">Custom Size</option>
                                    </select>
                                    <input type="text" id="customEnglishSize" placeholder="Enter custom size (e.g., 1.8rem)" class="custom-option w-full p-2 border border-orange-200 rounded-lg bg-yellow-50 text-sm">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-yellow-800">Share Description</label>
                        <textarea id="shareDescription" class="w-full p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900 resize-y h-16" placeholder="Custom text that will appear when users share"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-yellow-800">Background Color/Image URL</label>
                            <input type="text" id="background" class="w-full p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900" placeholder="Hex color code or image URL">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-yellow-800">Second Page Background</label>
                            <input type="text" id="secondBackground" class="w-full p-2 sm:p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-yellow-50 font-semibold text-purple-900" placeholder="Hex color code or image URL">
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Main Media Upload Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-purple-400 festive-bg festive-shadow">
            <div class="bg-gradient-to-r from-purple-700 via-pink-500 to-yellow-400 p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-yellow-50">Main Media Upload</h2>
            </div>
            <div class="p-4 sm:p-6">
                <label class="block text-sm font-semibold text-purple-800 mb-2">Image/Video/GIF (Top Media)</label>
                <div id="mediaDropArea" class="drag-drop p-4 sm:p-6 rounded-lg text-center cursor-pointer border-4 border-dashed border-yellow-400 hover:border-purple-500 bg-gradient-to-br from-yellow-50 to-pink-100 transition-all duration-200">
                    <p id="mediaPlaceholder" class="text-purple-700 flex items-center justify-center gap-2 text-sm sm:text-base">
                        <span>üé® Drag & drop or click to upload (Image, Video, GIF)</span>
                    </p>
                    <div id="mediaPreview" class="preview-container hidden mt-4"></div>
                    <input type="file" id="media" accept="image/*,video/*,.gif" class="hidden">
                </div>
            </div>
        </div>

        <!-- Title Frame Image Upload Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-blue-400 festive-bg festive-shadow">
            <div class="bg-gradient-to-r from-blue-600 via-green-400 to-teal-400 p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-white">Title Frame Image</h2>
            </div>
            <div class="p-4 sm:p-6">
                <label class="block text-sm font-semibold text-blue-800 mb-2">Title Frame Image (PNG with transparency recommended)</label>
                <div id="titleFrameDropArea" class="drag-drop p-4 sm:p-6 rounded-lg text-center cursor-pointer border-4 border-dashed border-blue-400 hover:border-teal-500 bg-gradient-to-br from-blue-50 to-teal-100 transition-all duration-200">
                    <p id="titleFramePlaceholder" class="text-blue-700 flex items-center justify-center gap-2 text-sm sm:text-base">
                        <span>üñºÔ∏è Drag & drop or click to upload title frame PNG</span>
                    </p>
                    <div id="titleFramePreview" class="preview-container hidden mt-4"></div>
                    <input type="file" id="titleFrameImageInput" accept="image/png, image/jpeg, image/gif" class="hidden">
                </div>
            </div>
        </div>

        <!-- Wish Box Background Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-green-400 festive-bg festive-shadow">
            <div class="bg-gradient-to-r from-green-600 via-teal-400 to-blue-400 p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-white">Wish Box Background Image</h2>
            </div>
            <div class="p-4 sm:p-6">
                <label class="block text-sm font-semibold text-green-800 mb-2">Wish Box Background Image</label>
                <div id="wishBgDropArea" class="drag-drop p-4 sm:p-6 rounded-lg text-center cursor-pointer border-4 border-dashed border-green-400 hover:border-blue-500 bg-gradient-to-br from-green-50 to-blue-100 transition-all duration-200">
                    <p id="wishBgPlaceholder" class="text-green-700 flex items-center justify-center gap-2 text-sm sm:text-base">
                        <span>üéÅ Drag & drop or click to upload wish box background</span>
                    </p>
                    <div id="wishBgPreview" class="preview-container hidden mt-4"></div>
                    <input type="file" id="wishBg" accept="image/*" class="hidden">
                </div>
                <div class="mt-4 grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-green-800">Background Size</label>
                        <select id="wishBgSize" class="w-full p-2 sm:p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:border-transparent bg-green-50 font-semibold text-green-900">
                            <option value="cover">Cover</option>
                            <option value="contain">Contain</option>
                            <option value="auto">Auto</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-green-800">Background Repeat</label>
                        <select id="wishBgRepeat" class="w-full p-2 sm:p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:border-transparent bg-green-50 font-semibold text-green-900">
                            <option value="no-repeat">No Repeat</option>
                            <option value="repeat">Repeat</option>
                            <option value="repeat-x">Repeat X</option>
                            <option value="repeat-y">Repeat Y</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audio Upload Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-orange-400 festive-bg festive-shadow">
            <div class="bg-gradient-to-r from-orange-600 via-yellow-400 to-pink-400 p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-white">Audio Upload</h2>
            </div>
            <div class="p-4 sm:p-6">
                <label class="block text-sm font-semibold text-orange-800 mb-2">Background Audio</label>
                <div id="audioDropArea" class="drag-drop p-4 sm:p-6 rounded-lg text-center cursor-pointer border-4 border-dashed border-orange-400 hover:border-pink-500 bg-gradient-to-br from-yellow-50 to-orange-100 transition-all duration-200">
                    <p id="audioPlaceholder" class="text-orange-700 flex items-center justify-center gap-2 text-sm sm:text-base">
                        <span>üéµ Drag & drop or click to upload (Audio)</span>
                    </p>
                    <div id="audioPreview" class="preview-container hidden mt-4"></div>
                    <input type="file" id="audio" accept="audio/*" class="hidden">
                </div>
            </div>
        </div>

        <!-- Effects Section -->
        <div class="mb-4 sm:mb-6 rounded-xl shadow-lg border-2 border-pink-400 festive-bg festive-shadow">
            <div class="bg-gradient-to-r from-pink-600 via-yellow-400 to-purple-500 p-3 sm:p-4 rounded-t-lg">
                <h2 class="text-lg sm:text-xl font-bold text-white">Effects & Design</h2>
            </div>
            <div class="p-4 sm:p-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Autoplay Audio</label>
                        <select id="autoplay" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="true">True</option>
                            <option value="false">False</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Animation Type</label>
                        <select id="animationType" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="float">Floating Emojis</option>
                            <option value="fall">Falling Emojis</option>
                            <option value="swirl">Swirling Emojis</option>
                            <option value="fireworks">Fireworks</option>
                            <option value="confetti">Confetti</option>
                            <option value="custom">Custom Animation</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Animation Speed</label>
                        <select id="animationSpeed" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="0.5">Very Slow (0.5x)</option>
                            <option value="0.75">Slow (0.75x)</option>
                            <option value="1" selected>Normal (1x)</option>
                            <option value="1.5">Fast (1.5x)</option>
                            <option value="2">Very Fast (2x)</option>
                            <option value="custom">Custom Speed</option>
                        </select>
                        <input type="number" id="customSpeed" placeholder="Enter custom speed" step="0.1" min="0.1" max="5" class="custom-option w-full p-2 border border-pink-200 rounded-lg bg-pink-50 text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Animation Quantity</label>
                        <select id="animationQuantity" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="very-high">Very High</option>
                            <option value="custom">Custom</option>
                        </select>
                        <input type="number" id="customQuantity" placeholder="Enter quantity" min="1" max="100" class="custom-option w-full p-2 border border-pink-200 rounded-lg bg-pink-50 text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Emoji Type</label>
                        <select id="emojiType" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="flowers">Flowers</option>
                            <option value="diyas">Diyas</option>
                            <option value="rangoli">Rangoli</option>
                            <option value="festive">Festive Symbols</option>
                            <option value="hearts">Hearts</option>
                            <option value="stars">Stars</option>
                            <option value="mixed">Mixed</option>
                            <option value="custom">Custom Emojis</option>
                        </select>
                        <input type="text" id="customEmojis" placeholder="Enter emojis separated by commas" class="custom-option w-full p-2 border border-pink-200 rounded-lg bg-pink-50 text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Animation Enable</label>
                        <select id="animationEnable" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="true">True</option>
                            <option value="false">False</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Button Style</label>
                        <select id="buttonStyle" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="gradient">Gradient</option>
                            <option value="solid">Solid Color</option>
                            <option value="outline">Outline</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-pink-800">Button Color</label>
                        <select id="buttonColorType" class="w-full p-2 sm:p-3 border border-pink-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent bg-pink-50 font-semibold text-pink-900">
                            <option value="preset">Preset Colors</option>
                            <option value="custom">Custom Color</option>
                        </select>
                        <input type="color" id="buttonColor" value="#eab308" class="custom-option w-full h-8">
                        <input type="text" id="customButtonColor" placeholder="Enter hex code" class="custom-option w-full p-2 border border-pink-200 rounded-lg bg-pink-50 text-sm">
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6 mt-6 sm:mt-8">
            <button type="submit" form="settingsForm" class="festive-btn px-8 py-3 rounded-full font-bold shadow-xl text-lg transition-all hover:scale-105">üíæ Save</button>
            <button type="button" id="resetBtn" class="bg-gradient-to-r from-gray-600 to-gray-800 text-white px-8 py-3 rounded-full font-bold shadow-xl text-lg transition-all hover:scale-105">üîÑ Reset</button>
        </div>
    </div>

    <!-- Custom Editor Modal -->
    <div id="customEditor" class="custom-editor">
        <div class="editor-content">
            <h3 class="text-xl font-bold mb-4" id="editorTitle">Edit Content</h3>
            <textarea id="editorTextarea" class="w-full p-3 border border-gray-300 rounded-lg h-40"></textarea>
            <div class="mt-4 flex justify-end gap-3">
                <button id="cancelEdit" class="px-4 py-2 bg-gray-200 rounded-lg">Cancel</button>
                <button id="saveEdit" class="px-4 py-2 bg-blue-500 text-white rounded-lg">Save</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase Client
        const supabaseUrl = 'https://udupfqyxsxfmcekumrph.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVkdXBmcXl4c3hmbWNla3VtcnBoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1NTgxOTYsImV4cCI6MjA2NjEzNDE5Nn0.-ndlXo0XeRrzONovcOeiMZxeYY4st7XUXyVdWZVbZJs';
        const supaClient = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // DOM Element References - Store references to frequently used DOM elements
        const mainBackground = document.getElementById('mainBackground');
        const secondBackground = document.getElementById('secondBackground');
        const mediaBox = document.getElementById('mediaBox'); // Main media element
        const titleFrameImage = document.getElementById('titleFrameImage'); // Image for title frame
        const festivalTitle = document.getElementById('festivalTitle');
        const contentFrameImage = document.getElementById('contentFrameImage'); // Image for wish box background
        const hindiWishElement = document.getElementById('hindiWish');
        const englishWishElement = document.getElementById('englishWish');
        const userNameInput = document.getElementById('userName');
        const actionButtonsContainer = document.getElementById('actionButtons');
        const shareBtn = document.getElementById('shareBtn');
        const copyBtn = document.getElementById('copyBtn');
        const translateBtn = document.getElementById('translateBtn'); // Translate button
        const backgroundAudio = document.getElementById('backgroundAudio');
        const bottomAd = document.getElementById('bottomAd');
        const footerAd = document.getElementById('footerAd');
        const secondPageSection = document.getElementById('secondPage');
        const animationContainer = document.getElementById('animationContainer');
        
        // Constants
        const FIXED_SHARE_URL = 'https://heykishannn.github.io/Festival/'; // The base URL for sharing
        
        // State variables to track current status
        let isTranslated = false; // Track if English wish is currently displayed
        let originalHindiWish = '‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç'; // Default Hindi wish
        let originalEnglishWish = 'Best Wishes'; // Default English wish
        let shareDescription = 'sent you festival wishes!'; // Default text for sharing
        let hasSecondPageContent = false; // Flag to indicate if the second page is used
        let audioPlayAttempted = false; // Flag to prevent multiple audio play attempts
        
        // Default settings for fallback if Supabase fails or no settings are found
        const defaultSettings = {
            background: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)',
            title: 'Festival Wishes',
            hindiWish: '‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç',
            englishWish: 'Best Wishes',
            shareDescription: 'sent you festival wishes!',
            mediaUrl: '', // URL for the main media (image/video)
            titleFrameUrl: '', // URL for the title frame image
            wishBgUrl: '', // URL for the wish box background image
            audioUrl: '',
            animationEnable: false,
            animationType: 'float',
            emojiType: 'mixed',
            customEmojis: '',
            animationQuantity: 'medium',
            customQuantity: '',
            animationSpeed: '1',
            titleFont: "'Poppins', sans-serif", titleColor: '#4c1d95', titleSize: '2rem', // Default title styles with size
            hindiFont: "'Noto Sans Devanagari', sans-serif", hindiColor: '#4c1d95', hindiSize: '1.5rem', // Default Hindi wish styles with size
            englishFont: "'Poppins', sans-serif", englishColor: '#4c1d95', englishSize: '1.5rem', // Default English wish styles with size
            buttonStyle: 'gradient', buttonColor: '#4CAF50'
        };
        
        // Event Listener: Resume audio playback when the tab becomes visible again
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                playBackgroundAudio(); // Attempt to play audio when tab is active
            } else {
                backgroundAudio.pause(); // Pause audio when tab is hidden
            }
        });

        // Function to play background audio, respecting browser autoplay policies
        function playBackgroundAudio() {
            if (backgroundAudio.src && !audioPlayAttempted) { // Only if audio source exists and play hasn't been attempted
                const playPromise = backgroundAudio.play(); // Attempt to play audio
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        audioPlayAttempted = true; // Mark play as attempted
                        console.log('Background audio playing.');
                    })
                    .catch(error => {
                        console.log('Autoplay prevented:', error);
                        // If autoplay is blocked, listen for user interaction (like a click) to play audio
                        const onceOptions = { once: true }; // Listen only once
                        document.body.addEventListener('click', () => {
                            backgroundAudio.play().then(() => {
                                audioPlayAttempted = true; // Mark play as attempted after interaction
                                console.log('Background audio playing after user interaction.');
                            }).catch(e => console.log('Autoplay still prevented:', e)); // Handle cases where even interaction fails
                        }, onceOptions);
                    });
                }
            }
        }
        
        // Function to dynamically adjust frame heights and text padding based on loaded content
        function adjustFrameHeightsAndTextPadding() {
            // Adjust Title Frame height based on the uploaded image's aspect ratio
            if (titleFrameImage.src && titleFrameImage.complete) { // Ensure image is loaded
                if (titleFrameImage.naturalHeight > 0 && titleFrameImage.naturalWidth > 0) {
                    const aspectRatio = titleFrameImage.naturalHeight / titleFrameImage.naturalWidth;
                    const containerWidth = titleFrameImage.parentElement.offsetWidth;
                    // Set height of the container to maintain the image's aspect ratio
                    titleFrameImage.parentElement.style.height = `${containerWidth * aspectRatio}px`; 
                    
                    // Font size is applied directly from settings. No dynamic adjustment needed here.
                    
                } else { // Handle broken image links or zero dimensions
                    titleFrameImage.parentElement.style.display = 'none'; // Hide the container if image is invalid
                }
            } else { // Hide if image is not loaded yet or no src is set
                titleFrameImage.parentElement.style.display = titleFrameImage.src ? 'flex' : 'none';
            }
            
            // Adjust Content Frame height based on the uploaded image's aspect ratio
            if (contentFrameImage.src && contentFrameImage.complete) { // Ensure image is loaded
                if (contentFrameImage.naturalHeight > 0 && contentFrameImage.naturalWidth > 0) {
                    const aspectRatio = contentFrameImage.naturalHeight / contentFrameImage.naturalWidth;
                    const containerWidth = contentFrameImage.parentElement.offsetWidth;
                    contentFrameImage.parentElement.style.height = `${containerWidth * aspectRatio}px`; // Set height based on aspect ratio
                    
                    // Dynamically adjust padding of wish text container based on text length for better fitting
                    const textElement = isTranslated ? englishWishElement : hindiWishElement; // Get the currently displayed text element
                    const textContent = textElement.innerHTML.replace(/<br>/g, ''); // Remove <br> tags for accurate length calculation
                    const textLength = textContent.length;
                    
                    // Calculate padding percentage: decrease padding for longer text to reveal more background
                    const basePaddingPercent = 25; // Max padding percentage
                    const minPaddingPercent = 8;  // Min padding percentage
                    const sensitivityFactor = 0.5; // Adjust how much padding decreases per character
                    
                    const paddingPercent = Math.max(minPaddingPercent, basePaddingPercent - (textLength - 50) * sensitivityFactor); // Formula ensures padding stays within limits
                    
                    document.querySelector('.wish-text-container').style.padding = `${paddingPercent}%`; // Apply calculated padding

                } else { // Handle broken image links or zero dimensions
                    contentFrameImage.parentElement.style.display = 'none';
                }
            } else { // Hide frame if image is not loaded or no src is set
                contentFrameImage.parentElement.style.display = contentFrameImage.src ? 'flex' : 'none';
            }
        }

        // Function to process wish text: converts newlines into <br> tags for HTML display
        function processWishText(text) {
            if (!text) return ''; // Return empty string if text is null or undefined
            return text.replace(/\n/g, '<br>'); // Replace newline characters with <br> tags
        }

        // Function to load settings from Supabase and apply them to the page
        async function loadSettings() {
            try {
                const { data, error } = await supaClient
                    .from('settings')
                    .select('value')
                    .eq('id', 'festival_settings')
                    .single(); // Fetch the single settings record

                // Merge fetched settings with default settings to ensure all properties are present
                const settings = (data && data.value) ? { ...defaultSettings, ...data.value } : defaultSettings;

                // Apply Backgrounds
                if (settings.background) {
                    if (settings.background.startsWith('http') || settings.background.startsWith('data:')) {
                        mainBackground.style.backgroundImage = `url('${settings.background}')`; // Use URL for images
                    } else {
                        mainBackground.style.background = settings.background; // Use value directly for gradients/colors
                    }
                }

                // Apply Second Background if provided
                if (settings.secondBackground) {
                    if (settings.secondBackground.startsWith('http') || settings.secondBackground.startsWith('data:')) {
                        secondBackground.style.backgroundImage = `url('${settings.secondBackground}')`;
                        secondBackground.style.display = 'block'; // Make the second background element visible
                    } else {
                        secondBackground.style.background = settings.secondBackground;
                        secondBackground.style.display = 'block';
                    }    
                }

                // Set Title and Meta Title
                document.title = settings.title || defaultSettings.title;
                festivalTitle.textContent = settings.title || defaultSettings.title;

                // Apply Title Styles (Font, Color, Size)
                festivalTitle.style.fontFamily = settings.titleFont || defaultSettings.titleFont;
                festivalTitle.style.color = settings.titleColor || defaultSettings.titleColor;
                // Apply font size directly from settings. If 'custom' is selected, use custom value, else use the selected value.
                festivalTitle.style.fontSize = (settings.titleSize === 'custom' && settings.customTitleSize)
                                             ? settings.customTitleSize
                                             : settings.titleSize || defaultSettings.titleSize;

                // Set Wishes and their styles
                originalHindiWish = settings.hindiWish || defaultSettings.hindiWish;
                originalEnglishWish = settings.englishWish || defaultSettings.englishWish;
                
                hindiWishElement.innerHTML = processWishText(originalHindiWish); // Set Hindi wish with <br> tags
                hindiWishElement.style.fontFamily = settings.hindiFont || defaultSettings.hindiFont;
                hindiWishElement.style.color = settings.hindiColor || defaultSettings.hindiColor;
                // Apply font size directly from settings. If 'custom', use custom value, else selected value.
                hindiWishElement.style.fontSize = (settings.hindiSize === 'custom' && settings.customHindiSize)
                                                ? settings.customHindiSize
                                                : settings.hindiSize || defaultSettings.hindiSize;

                // Handle English wish and translation button visibility
                if (originalEnglishWish && originalEnglishWish.trim() !== '') {
                    englishWishElement.innerHTML = processWishText(originalEnglishWish);
                    englishWishElement.style.fontFamily = settings.englishFont || defaultSettings.englishFont;
                    englishWishElement.style.color = settings.englishColor || defaultSettings.englishColor;
                    englishWishElement.style.fontSize = (settings.englishSize === 'custom' && settings.customEnglishSize)
                                                      ? settings.customEnglishSize
                                                      : settings.englishSize || defaultSettings.englishSize; // Apply size directly
                    
                    translateBtn.classList.remove('hidden'); // Show translate button
                } else {
                    englishWishElement.classList.add('hidden'); // Hide if no English wish is available
                    translateBtn.classList.add('hidden');
                }

                // Set Share Description text
                shareDescription = settings.shareDescription || defaultSettings.shareDescription;

                // Set Media (Image or Video) for the main media box
                if (settings.mediaUrl && settings.mediaUrl.trim() !== '') {
                    mediaBox.innerHTML = ''; // Clear any previous media content
                    let mediaElement = null;
                    // Determine if it's a video or image based on the URL extension
                    if (settings.mediaUrl.toLowerCase().endsWith('.mp4') || settings.mediaUrl.toLowerCase().endsWith('.webm')) {
                        mediaElement = document.createElement('video');
                        mediaElement.autoplay = true; // Autoplay video
                        mediaElement.loop = true;      // Loop video playback
                        mediaElement.muted = true;     // Mute video for autoplay compliance
                        mediaElement.controls = false; // Hide controls for background video
                    } else {
                        mediaElement = document.createElement('img'); // It's an image
                    }
                    mediaElement.src = settings.mediaUrl;
                    mediaElement.style.width = '100%';
                    mediaElement.style.height = 'auto';
                    mediaElement.style.display = 'block';
                    mediaBox.appendChild(mediaElement);
                }

                // Set Title Frame Image
                if (settings.titleFrameUrl && settings.titleFrameUrl.trim() !== '') {
                    titleFrameImage.src = settings.titleFrameUrl;
                    // Use onload event to ensure dimensions are ready before adjusting layout
                    titleFrameImage.onload = adjustFrameHeightsAndTextPadding; 
                    titleFrameImage.onerror = function() { // Handle cases where image loading fails
                        console.error('Failed to load title frame image:', this.src);
                        this.parentElement.style.display = 'none'; // Hide frame container if image is broken
                    };
                } else {
                    titleFrameImage.style.display = 'none'; // Hide frame if no URL is provided
                }

                // Set Content Frame Image (Wish Box Background)
                if (settings.wishBgUrl && settings.wishBgUrl.trim() !== '') {
                    contentFrameImage.src = settings.wishBgUrl;
                    contentFrameImage.onload = adjustFrameHeightsAndTextPadding; // Adjust layout on image load
                    contentFrameImage.onerror = function() { // Handle broken image links
                        console.error('Failed to load content frame image:', this.src);
                        this.parentElement.style.display = 'none'; // Hide frame container if image fails
                    };
                    // Apply background size and repeat properties to the parent container of the image
                    contentFrameImage.parentElement.style.objectFit = settings.wishBgSize || 'cover'; // Default to 'cover' if not specified
                    contentFrameImage.parentElement.style.backgroundRepeat = settings.wishBgRepeat || 'no-repeat'; // Default to 'no-repeat'
                } else {
                    contentFrameImage.style.display = 'none'; // Hide frame if no URL is provided
                }

                // Set Background Audio source
                if (settings.audioUrl && settings.audioUrl.trim() !== '') {
                    backgroundAudio.src = settings.audioUrl;
                    // Play audio immediately if autoplay is enabled in settings
                    if (settings.autoplay) {
                        playBackgroundAudio();
                    }
                }

                // Apply Button Styles based on admin's choices
                applyButtonStyles(settings.buttonStyle, settings.buttonColor);

                // Check if the second page content is enabled (admin sets a flag)
                if (settings.secondPageContent) { 
                    secondPageSection.style.display = 'flex'; // Show the second page section
                    hasSecondPageContent = true;
                }

                // Initialize animations if they are enabled
                if (settings.animationEnable) {
                    initAnimations(settings);
                }

                // Adjust scroll height and overflow properties based on the presence of the second page
                adjustScrollHeight();

                // Perform a final adjustment after all elements might have loaded, to ensure correct layout
                // Using a small timeout helps ensure all DOM manipulations are complete
                setTimeout(adjustFrameHeightsAndTextPadding, 100); 

            } catch (error) {
                console.error('Error loading settings from Supabase:', error);
                applyDefaultSettings(); // Apply default settings if Supabase loading fails
            }
        }
        
        // Apply default settings if Supabase fails or no settings are found
        function applyDefaultSettings() {
            document.title = defaultSettings.title;
            festivalTitle.textContent = defaultSettings.title;
            
            hindiWishElement.innerHTML = processWishText(defaultSettings.hindiWish);
            englishWishElement.innerHTML = processWishText(defaultSettings.englishWish);
            
            shareDescription = defaultSettings.shareDescription;
            
            // Hide frame images by default if no default URL is set (frames are optional)
            titleFrameImage.style.display = 'none';
            contentFrameImage.style.display = 'none';
            
            // Show the translate button only if an English wish is defined in the defaults
            if (defaultSettings.englishWish && defaultSettings.englishWish.trim() !== '') {
                translateBtn.classList.remove('hidden');
            } else {
                translateBtn.classList.add('hidden');
            }

            applyButtonStyles(defaultSettings.buttonStyle, defaultSettings.buttonColor); // Apply default button styles
            adjustScrollHeight(); // Adjust scroll based on the default page structure
        }

        // Initialize animations based on loaded settings
        function initAnimations(settings) {
            animationContainer.innerHTML = ''; // Clear any existing animations before starting new ones
            
            const emojiSet = getEmojiSet(settings.emojiType, settings.customEmojis); // Get the set of emojis to use
            const quantity = getAnimationQuantity(settings.animationQuantity, settings.customQuantity); // Get the number of emojis to display
            const speed = getAnimationSpeed(settings.animationSpeed, settings.customSpeed); // Get the animation speed multiplier
            const animationType = settings.animationType || 'float'; // Default to 'float' if type is not specified
            
            // Create the specified number of emoji elements and append them to the animation container
            for (let i = 0; i < quantity; i++) {
                createEmoji(emojiSet, speed, animationType);
            }
        }
        
        // Function to create and append a single animated emoji element
        function createEmoji(emojiSet, speed, animationType) {
            const emoji = document.createElement('div');
            emoji.textContent = emojiSet[Math.floor(Math.random() * emojiSet.length)]; // Pick a random emoji from the set
            emoji.style.fontSize = `${Math.random() * 20 + 16}px`; // Randomize emoji size for variety
        
            switch(animationType) {
                case 'fall':
                    emoji.className = 'falling-emoji';
                    emoji.style.top = '-50px'; // Start above the viewport
                    emoji.style.left = `${Math.random() * 100}%`; // Random horizontal position
                    emoji.style.fontSize = `${1 + Math.random() * 2}rem`; // Larger random sizes for falling effect
                    emoji.style.animationDuration = `${(2 + Math.random() * 3) / speed}s`; // Random duration, scaled by speed
                    break;              
                case 'swirl':
                    emoji.className = 'swirling-emoji';
                    emoji.style.animationDuration = `${8 / speed}s`; // Adjust duration based on speed
                    emoji.style.left = `${Math.random() * 100}%`;
                    emoji.style.top = `${Math.random() * 100}%`;
                    break;
                case 'fireworks':
                    emoji.className = 'fireworks-emoji';
                    emoji.style.setProperty('--tx', `${Math.random() * 200 - 100}px`); // Random horizontal offset for explosion
                    emoji.style.setProperty('--ty', `${Math.random() * 200 - 100}px`); // Random vertical offset for explosion
                    emoji.style.left = '50%'; // Center point for explosion
                    emoji.style.top = '50%';
                    emoji.style.animationDuration = `${1 / speed}s`; // Fast animation, scaled by speed
                    break;
                case 'confetti':
                    emoji.className = 'fireworks-emoji'; // Re-use fireworks animation styling for confetti
                    emoji.style.setProperty('--tx', `${Math.random() * 200 - 100}px`);
                    emoji.style.setProperty('--ty', `${Math.random() * 200 - 100}px`);
                    emoji.style.left = '50%';
                    emoji.style.top = '50%';
                    emoji.style.animationDuration = `${1.5 / speed}s`; // Slightly longer duration for confetti
                    break;
                default: // 'float' animation (default behavior)
                    emoji.className = 'floating-emoji';
                    emoji.style.animationDuration = `${3 / speed}s`; // Adjust duration based on speed
                    emoji.style.left = `${Math.random() * 100}%`;
                    emoji.style.top = `${Math.random() * 100}%`;
            }
        
            animationContainer.appendChild(emoji); // Add the created emoji to the animation container
            
            // For animations that should disappear after playing once (fall, fireworks, confetti),
            // add an event listener to remove the element and create a new one when the animation ends.
            if (animationType === 'fall' || animationType === 'fireworks' || animationType === 'confetti') {
                emoji.addEventListener('animationend', () => {
                    emoji.remove(); // Remove the emoji element after its animation is finished
                    createEmoji(emojiSet, speed, animationType); // Create a replacement emoji to maintain quantity
                });
            }
        }
        
        // Helper function to get an emoji set based on type or custom input
        function getEmojiSet(type, customEmojis) {
            const sets = { // Predefined emoji sets for different animation types
                flowers: ['üå∏', 'üå∫', 'üåª', 'üåº', 'üå∑', 'üíê'],
                diyas: ['ü™î', '‚ú®', 'üïØÔ∏è', 'üåü'],
                rangoli: ['üü°', 'üî¥', 'üü¢', 'üîµ', 'üü£'],
                festive: ['üéâ', 'üéä', 'ü™Ö', 'üéÅ', 'üßß'],
                hearts: ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú'],
                stars: ['‚≠ê', 'üåü', '‚ú®', 'üí´'],
                mixed: ['üéâ', '‚ú®', '‚ù§Ô∏è', 'üå∏', 'üåü', 'üé∂', 'üíñ', 'üí´'] // A general mix
            };
            
            if (type === 'custom' && customEmojis) {
                const emojis = customEmojis.split(',').map(e => e.trim()).filter(e => e.length > 0); // Split custom emojis and clean them
                if (emojis.length > 0) return emojis; // Return custom emojis if they are valid
            }
            return sets[type] || sets.mixed; // Fallback to the 'mixed' set if type is invalid or custom emojis are empty
        }
        
        // Helper function to get the desired animation quantity (number of emojis)
        function getAnimationQuantity(type, customQuantity) {
            const quantities = { // Mapping of quantity levels to the number of emojis
                low: 5,
                medium: 10,
                high: 20,
                'very-high': 30
            };
            
            if (type === 'custom' && customQuantity) {
                const qty = parseInt(customQuantity);
                // Ensure quantity is a positive number and cap it at 100 for performance
                if (!isNaN(qty) && qty > 0) return Math.min(100, qty); 
            }
            return quantities[type] || 10; // Default to medium quantity if type is invalid
        }
        
        // Helper function to get the animation speed multiplier
        function getAnimationSpeed(type, customSpeed) {
            if (type === 'custom' && customSpeed) {
                const speed = parseFloat(customSpeed);
                // Ensure speed is a valid positive number
                if (!isNaN(speed) && speed > 0) return speed; 
            }
            return parseFloat(type) || 1; // Default to 1x speed if type is invalid or not 'custom'
        }
        
        // Function to apply button styles based on admin's selected style and color
        function applyButtonStyles(style, color) {
            const buttons = [shareBtn, copyBtn]; // Apply styles to both action buttons
            
            // Use default values if style or color are not provided
            if (!style) style = 'gradient';
            if (!color) color = '#4CAF50';

            if (style === 'gradient') {
                const color1 = color;
                const color2 = adjustColor(color, -20); // Create a slightly darker shade for the gradient
                
                buttons.forEach(btn => {
                    btn.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
                    btn.style.border = 'none'; // Remove border for gradient style
                    btn.style.color = 'white'; // Ensure text color is white
                });
            } else if (style === 'solid') {
                buttons.forEach(btn => {
                    btn.style.background = color;
                    btn.style.border = 'none'; // Remove border for solid color style
                    btn.style.color = 'white';
                });
            } else if (style === 'outline') {
                buttons.forEach(btn => {
                    btn.style.background = 'transparent'; // Make background transparent
                    btn.style.border = `2px solid ${color}`; // Set border color from settings
                    btn.style.color = color; // Set text color to match the border color
                });
            }
        }
        
        // Helper function to adjust color brightness/darkness for gradients
        function adjustColor(color, amount) {
            let usePound = false;
            if (color[0] === "#") { // Check if hex code starts with #
                color = color.slice(1); // Remove #
                usePound = true; // Remember to add # back later
            }

            // Parse hex color string into RGB components
            let r = parseInt(color.substring(0, 2), 16);
            let g = parseInt(color.substring(2, 4), 16);
            let b = parseInt(color.substring(4, 6), 16);

            // Adjust RGB values, clamping them between 0 (black) and 255 (white)
            r = Math.min(255, Math.max(0, r + amount));
            g = Math.min(255, Math.max(0, g + amount));
            b = Math.min(255, Math.max(0, b + amount));

            // Convert the adjusted RGB components back into a hex color string
            const newColor = `#${(1 << 24 | r << 16 | g << 8 | b).toString(16).slice(1)}`;
            return usePound ? newColor : newColor.slice(1); // Return with # if original color had it
        }
        
        // Adjust scroll height and overflow properties based on whether the second page content is used
        function adjustScrollHeight() {
            if (!hasSecondPageContent) { // If only one page of content is expected
                 document.body.style.minHeight = '100vh'; // Ensure body takes full viewport height
                 document.documentElement.style.height = 'auto';
                 document.body.style.overflowY = 'auto'; // Allow scrolling if content exceeds viewport height
            } else { // If multiple pages are possible
                document.body.style.minHeight = '100vh'; // Maintain minimum height
                document.body.style.height = 'auto';
                document.body.style.overflowY = 'auto';
            }
        }
        
        // Event Listener for the username input field: shows action buttons once a name is entered
        userNameInput.addEventListener('input', () => {
            if (userNameInput.value.trim()) { // Check if the username input is not empty after trimming whitespace
                actionButtonsContainer.classList.remove('hidden'); // Show the share and copy buttons
            } else {
                actionButtonsContainer.classList.add('hidden'); // Hide buttons if the input is cleared
            }
        });
        
        // Event Listener for the translate button: toggles between Hindi and English wishes
        translateBtn.addEventListener('click', () => {
            // Only proceed if an English wish is actually available to display
            if (!originalEnglishWish || originalEnglishWish.trim() === '') {
                englishWishElement.textContent = ""; // Clear the English wish if it's empty
                translateBtn.classList.add('hidden'); // Hide the translate button
                return;
            }
            
            if (isTranslated) { // If currently showing English, switch back to Hindi
                hindiWishElement.classList.remove('hidden'); // Show Hindi wish
                englishWishElement.classList.add('hidden'); // Hide English wish
                translateBtn.textContent = 'Translate to English'; // Update button text
            } else { // If currently showing Hindi, switch to English
                hindiWishElement.classList.add('hidden'); // Hide Hindi wish
                englishWishElement.classList.remove('hidden'); // Show English wish
                translateBtn.textContent = 'Show in Hindi'; // Update button text
            }
            isTranslated = !isTranslated; // Toggle the translation state
        });
        
        // Event Listener for the share button: handles the sharing functionality
        shareBtn.addEventListener('click', async () => {
            const name = userNameInput.value.trim() || "Someone"; // Get username or default to "Someone"
            const shareMessage = `${name} ${shareDescription}\n${FIXED_SHARE_URL}`; // Construct the complete share message

            try {
                if (navigator.share) { // Use Web Share API if available (primarily for mobile devices)
                    await navigator.share({
                        title: document.title, // Title for sharing
                        text: shareMessage,    // The message content
                        url: FIXED_SHARE_URL   // The URL to share
                    });
                } else if (navigator.clipboard) { // Use Clipboard API if available (desktop and modern mobile browsers)
                    await navigator.clipboard.writeText(shareMessage); // Copy the message to the clipboard
                    alert('Share message copied to clipboard!');
                    // Optionally, attempt to open WhatsApp on mobile for direct sharing after copying
                    if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                        window.open(`https://wa.me/?text=${encodeURIComponent(shareMessage)}`, '_blank');
                    }
                } else { // Fallback for older browsers or environments without Clipboard API
                    // Attempt to open WhatsApp on mobile
                    if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                        window.open(`https://wa.me/?text=${encodeURIComponent(shareMessage)}`, '_blank');
                    } else {
                        // For desktop, use a manual copy method if Clipboard API fails
                        fallbackCopyText(shareMessage);
                    }
                }
            } catch (err) {
                console.error('Error during sharing:', err);
                alert('Could not share the wish. Please try copying the link manually: ' + FIXED_SHARE_URL);
            }
        });
        
        // Event Listener for the copy button: copies the wish message to the clipboard
        copyBtn.addEventListener('click', () => {
            const name = userNameInput.value.trim() || "Someone";
            const shareMessage = `${name} ${shareDescription}\n${FIXED_SHARE_URL}`;
            
            if (navigator.clipboard) { // Prefer using the Clipboard API for copying
                navigator.clipboard.writeText(shareMessage).then(() => {
                    alert('Wish copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy text using Clipboard API:', err);
                    fallbackCopyText(shareMessage); // Use fallback method if Clipboard API fails
                });
            } else {
                fallbackCopyText(shareMessage); // Use fallback method if Clipboard API is not available
            }
        });
        
        // Fallback function for copying text to clipboard using execCommand (for older browsers)
        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            // Make the textarea invisible and off-screen to avoid visual disruption
            textArea.style.position = 'absolute';
            textArea.style.left = '-9999px';
            document.body.appendChild(textArea); // Add to the DOM
            textArea.select(); // Select the text within the textarea
            
            try {
                document.execCommand('copy'); // Execute the copy command
                alert('Wish copied to clipboard!');
            } catch (err) {
                console.error('Fallback copy failed:', err);
                alert('Could not copy text. Please select and copy manually.');
            }
            
            document.body.removeChild(textArea); // Remove the temporary textarea from the DOM after copying
        }
        
        // Initialize the application when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings(); // Load settings from Supabase upon page load
            // Add a resize event listener to re-adjust layout elements (frames, text sizes)
            // This is crucial for responsiveness on window resize or orientation changes
            window.addEventListener('resize', () => {
                adjustFrameHeightsAndTextPadding();
                adjustScrollHeight();
            });
        });
    </script>
</body>
</html>